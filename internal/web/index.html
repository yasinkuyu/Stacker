<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacker - Development Environment</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <style>
        :root {
            /* Light theme - improved contrast */
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e8e8ec;
            --bg-hover: #d4d4d9;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-muted: #7a7a7a;
            --accent: #6366f1;
            --accent-hover: #5558d6;
            --accent-light: rgba(99, 102, 241, 0.15);
            --success: #059669;
            --success-bg: rgba(5, 150, 105, 0.15);
            --warning: #d97706;
            --warning-bg: rgba(217, 119, 6, 0.15);
            --danger: #dc2626;
            --danger-bg: rgba(220, 38, 38, 0.15);
            --border: #d4d4d9;
            --border-light: #e5e5ea;
            --shadow: rgba(0, 0, 0, 0.08);
            --shadow-lg: rgba(0, 0, 0, 0.15);
            --gradient-start: #6366f1;
            --gradient-end: #8b5cf6;
            --sidebar-width: 240px;
        }

        [data-theme="dark"] {
            /* Dark theme - improved contrast */
            --bg-primary: #0a0a0f;
            --bg-secondary: #14141a;
            --bg-tertiary: #1e1e28;
            --bg-hover: #282835;
            --text-primary: #f0f0f5;
            --text-secondary: #b8b8c5;
            --text-muted: #6b6b7a;
            --accent: #818cf8;
            --accent-hover: #a5b4fc;
            --accent-light: rgba(129, 140, 248, 0.15);
            --success: #34d399;
            --success-bg: rgba(52, 211, 153, 0.15);
            --warning: #fbbf24;
            --warning-bg: rgba(251, 191, 36, 0.15);
            --danger: #f87171;
            --danger-bg: rgba(248, 113, 113, 0.15);
            --border: #2a2a3a;
            --border-light: #3a3a4a;
            --shadow: rgba(0, 0, 0, 0.4);
            --shadow-lg: rgba(0, 0, 0, 0.6);
            --gradient-start: #818cf8;
            --gradient-end: #a78bfa;
        }

        body[data-slim="true"] {
            --sidebar-width: 200px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
            line-height: 1.5;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Loading Spinner */
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            height: calc(100vh - 32px);
            overflow-y: auto;
            z-index: 1000;
            transition: width 0.3s ease;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 24px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow-lg);
        }

        .logo-img {
            width: 36px;
            height: 36px;
            border-radius: 8px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }

        .logo-version {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .nav-section {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            padding: 16px 16px 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--accent-light);
            color: var(--accent);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            opacity: 0.8;
        }

        .nav-item.active .nav-icon {
            opacity: 1;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 80px 40px 40px;
            /* Increased top padding to avoid overlap with any window headers */
            margin-left: var(--sidebar-width);
            min-height: calc(100vh - 32px);
            margin-bottom: 32px;
            background: var(--bg-primary);
            position: relative;
            z-index: 1;
            overflow-x: hidden;
            transition: margin-left 0.3s ease, padding 0.3s ease;
        }

        body[data-slim="true"] .main-content {
            padding-bottom: 32px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow-lg);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .stat-icon.sites {
            background: var(--accent-light);
            color: var(--accent);
        }

        .stat-icon.services {
            background: var(--success-bg);
            color: var(--success);
        }

        .stat-icon.dumps {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .stat-icon.php {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .stat-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -1px;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px var(--shadow);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-body {
            padding: 0;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-light);
            transition: background 0.15s ease;
        }

        .list-item:hover {
            background: var(--bg-hover);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .item-info {
            flex: 1;
        }

        .item-primary {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .item-secondary {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-running {
            color: var(--success);
            background: var(--success-bg);
        }

        .status-stopped {
            color: var(--text-muted);
            background: var(--bg-tertiary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .status-running .status-dot {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .empty-state {
            text-align: center;
            padding: 64px 32px;
            color: var(--text-muted);
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            opacity: 0.5;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn:hover {
            background: var(--accent-light);
            color: var(--accent-hover);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white !important;
            font-weight: 600;
        }

        .btn-primary:hover {
            opacity: 0.9;
            box-shadow: 0 4px 12px var(--shadow-lg);
            transform: translateY(-2px);
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)) !important;
            color: white !important;
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: var(--danger-bg);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .btn-danger:hover {
            background: var(--danger);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px var(--danger-bg);
        }

        .btn-success {
            background: var(--success-bg);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .btn-success:hover {
            background: var(--success);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px var(--success-bg);
        }

        .btn-icon {
            width: 16px;
            height: 16px;
        }

        .btn.btn-icon-only {
            padding: 8px;
            min-width: auto;
        }

        .btn.btn-icon-only svg {
            margin: 0;
        }

        /* Settings */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section:first-child {
            padding-top: 24px;
        }

        .settings-section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            padding: 0 24px;
            margin-bottom: 12px;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-light);
        }

        .settings-row:last-child {
            border-bottom: none;
        }

        .settings-info {
            flex: 1;
        }

        .settings-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .settings-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Toggle Switch */
        .toggle-switch {
            width: 44px;
            height: 24px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0;
            display: inline-block;
            vertical-align: middle;
        }

        .toggle-switch.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            gap: 8px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: 12px;
        }

        .theme-btn {
            width: 44px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .theme-btn.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 2px 8px var(--shadow-lg);
        }

        .theme-btn:hover:not(.active) {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        /* Input */
        .input {
            padding: 10px 14px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            padding: 20px 24px;
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Status Bar */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 32px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 12px;
            color: var(--text-secondary);
            z-index: 1000;
        }

        .status-bar-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .server-status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Draw Panel - Slide-in Side Panel */
        .draw-panel-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .draw-panel-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .draw-panel {
            position: fixed;
            top: 0;
            right: -480px;
            width: 480px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            transition: right 0.3s ease;
            box-shadow: -8px 0 32px var(--shadow-lg);
        }

        .draw-panel.open {
            right: 0;
        }

        .draw-panel.wide {
            width: 800px;
            right: -800px;
        }

        .draw-panel.wide.open {
            right: 0;
        }

        .draw-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .draw-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .draw-panel-close {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: var(--bg-hover);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .draw-panel-close:hover {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .draw-panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .draw-panel-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        /* Custom Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 440px;
            max-width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            transform: scale(0.9);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }

        .modal-overlay.open .modal-content {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-tertiary);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--bg-hover);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .modal-body {
            padding: 24px;
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            background: var(--bg-tertiary);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Service Card */
        .service-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .service-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .service-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: var(--bg-tertiary);
        }

        .service-icon svg {
            width: 24px;
            height: 24px;
        }

        .service-icon.mysql {
            background: #00758f20;
            color: #00758f;
        }

        .service-icon.nginx {
            background: #00994420;
            color: #009944;
        }

        .service-icon.redis {
            background: #dc382d20;
            color: #dc382d;
        }

        .service-icon.php {
            background: #777bb420;
            color: #777bb4;
        }

        .service-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .service-port {
            font-size: 12px;
            color: var(--text-muted);
        }

        .service-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        /* Site Row */
        .site-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-light);
            transition: background 0.15s ease;
            gap: 16px;
        }

        .site-row:hover {
            background: var(--bg-hover);
        }

        .site-row:last-child {
            border-bottom: none;
        }

        .site-info {
            flex: 1;
            min-width: 0;
            cursor: pointer;
        }

        .site-name {
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .site-path {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .site-badges {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-shrink: 0;
        }

        .site-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .site-badge.php {
            background: rgba(119, 123, 180, 0.12);
            color: #777bb4;
            border: 1px solid rgba(119, 123, 180, 0.2);
        }

        .site-badge.ssl {
            background: rgba(52, 211, 153, 0.12);
            color: var(--success);
            border: 1px solid rgba(52, 211, 153, 0.2);
        }

        .site-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: var(--accent-light);
            color: var(--accent);
        }

        .icon-btn.danger:hover {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .progress-container {
            margin-top: 24px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .progress-bar-bg {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        .install-log {
            margin-top: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            max-height: 100px;
            overflow-y: auto;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        /* Slim Mode - Compact but readable */
        :root {
            --sidebar-width: 240px;
        }

        body[data-slim="true"] {
            --sidebar-width: 64px;
        }

        body[data-slim="true"] .sidebar {
            overflow-x: hidden;
        }

        body[data-slim="true"] .logo {
            padding: 16px 14px;
        }

        body[data-slim="true"] .logo-img {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        body[data-slim="true"] .logo-text {
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body[data-slim="true"] .logo-version {
            font-size: 10px;
        }

        body[data-slim="true"] .main-content {
            margin-left: var(--sidebar-width);
            padding: 18px;
        }

        body[data-slim="true"] .page-header {
            margin-bottom: 16px;
        }

        body[data-slim="true"] .page-title {
            font-size: 20px;
        }

        body[data-slim="true"] .page-subtitle {
            font-size: 12px;
        }

        body[data-slim="true"] .stats-grid {
            gap: 12px;
        }

        body[data-slim="true"] .stat-card {
            padding: 14px;
            gap: 12px;
        }

        body[data-slim="true"] .stat-icon {
            width: 36px;
            height: 36px;
            padding: 9px;
        }

        body[data-slim="true"] .stat-icon svg {
            width: 18px;
            height: 18px;
        }

        body[data-slim="true"] .stat-label {
            font-size: 11px;
            margin-bottom: 3px;
        }

        body[data-slim="true"] .stat-value {
            font-size: 24px;
        }

        body[data-slim="true"] .card {
            margin-bottom: 14px;
        }

        body[data-slim="true"] .card-header {
            padding: 12px 14px;
        }

        body[data-slim="true"] .card-title {
            font-size: 13px;
            font-weight: 600;
        }

        body[data-slim="true"] .card-body {
            padding: 14px;
        }

        body[data-slim="true"] .list-item {
            padding: 10px 12px;
            gap: 12px;
        }

        body[data-slim="true"] .item-primary {
            font-size: 13px;
            font-weight: 500;
        }

        body[data-slim="true"] .item-secondary {
            font-size: 11px;
        }

        body[data-slim="true"] .site-row {
            padding: 10px 12px;
            gap: 12px;
        }

        body[data-slim="true"] .site-name {
            font-size: 14px;
        }

        body[data-slim="true"] .site-path {
            font-size: 11px;
        }

        body[data-slim="true"] .site-badge {
            padding: 3px 8px;
            font-size: 9px;
            border-radius: 8px;
        }

        body[data-slim="true"] .icon-btn {
            width: 28px;
            height: 28px;
        }

        body[data-slim="true"] .icon-btn svg {
            width: 13px;
            height: 13px;
        }

        body[data-slim="true"] .nav-item {
            padding: 10px 14px;
            gap: 10px;
        }

        body[data-slim="true"] .nav-item svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        body[data-slim="true"] .sidebar-footer {
            padding: 12px 14px;
        }

        body[data-slim="true"] .server-status {
            font-size: 11px;
            white-space: nowrap;
        }

        body[data-slim="true"] .server-status-dot {
            width: 7px;
            height: 7px;
            flex-shrink: 0;
        }

        body[data-slim="true"] .settings-row {
            padding: 12px 14px;
            gap: 12px;
        }

        body[data-slim="true"] .settings-label {
            font-size: 12px;
        }

        body[data-slim="true"] .settings-desc {
            font-size: 10px;
        }

        body[data-slim="true"] .settings-section-title {
            font-size: 11px;
            padding: 10px 14px;
        }

        body[data-slim="true"] .form-label {
            font-size: 12px;
            margin-bottom: 5px;
        }

        body[data-slim="true"] .form-hint {
            font-size: 10px;
            margin-top: 3px;
        }

        body[data-slim="true"] .input {
            padding: 9px 11px;
            font-size: 12px;
        }

        body[data-slim="true"] .form-select {
            padding: 9px 11px;
            font-size: 12px;
        }

        body[data-slim="true"] .toggle-switch {
            width: 32px;
            height: 18px;
            border-radius: 9px;
            border-width: 1.5px;
        }

        body[data-slim="true"] .toggle-switch::after {
            width: 12px;
            height: 12px;
            top: 1.5px;
            left: 1.5px;
        }

        body[data-slim="true"] .toggle-switch.active::after {
            left: 15.5px;
        }

        body[data-slim="true"] .sidebar {
            width: 200px;
        }

        body[data-slim="true"] .main-content {
            padding-bottom: 32px;
        }

        body[data-slim="true"] .nav-item {
            padding: 12px 16px;
        }

        body[data-slim="true"] .nav-item span {
            display: inline;
        }

        body[data-slim="true"] .nav-section {
            display: none;
        }

        body[data-slim="true"] .logo-text,
        body[data-slim="true"] .logo-version {
            display: block;
        }

        body[data-slim="true"] .logo {
            justify-content: center;
            padding: 12px 0;
        }

        body[data-slim="true"] .draw-panel {
            width: 400px;
        }

        .service-version-select {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            margin-right: 8px;
            outline: none;
        }

        .service-version-select:focus {
            border-color: var(--accent);
        }

        body[data-slim="true"] .draw-panel-header {
            padding: 12px 16px;
        }

        body[data-slim="true"] .draw-panel-title {
            font-size: 14px;
        }

        body[data-slim="true"] .draw-panel-body {
            padding: 14px;
        }

        body[data-slim="true"] .draw-panel-footer {
            padding: 12px 16px;
            gap: 10px;
        }

        body[data-slim="true"] .quick-actions {
            gap: 8px;
            flex-wrap: wrap;
        }

        body[data-slim="true"] .quick-actions .btn {
            padding: 8px 12px;
            font-size: 12px;
            gap: 7px;
        }

        body[data-slim="true"] .quick-actions .btn svg {
            width: 15px;
            height: 15px;
        }

        body[data-slim="true"] .status-badge {
            padding: 4px 8px;
            font-size: 10px;
            gap: 5px;
        }

        body[data-slim="true"] .status-dot {
            width: 6px;
            height: 6px;
        }

        body[data-slim="true"] .empty-state {
            padding: 36px 18px;
        }

        body[data-slim="true"] .empty-icon {
            width: 52px;
            height: 52px;
        }

        body[data-slim="true"] .empty-state p {
            font-size: 13px;
        }

        body[data-slim="true"] .progress-label {
            font-size: 12px;
        }

        body[data-slim="true"] .progress-bar-bg {
            height: 7px;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <img src="/logo.png" class="logo-img" alt="Stacker" onerror="this.style.display='none'">
                <div>
                    <div class="logo-text">Stacker</div>
                    <div class="logo-version">v1.0.0</div>
                </div>
            </div>

            <nav class="nav">
                <div class="nav-section">Overview</div>
                <button class="nav-item active" data-page="dashboard">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" rx="1" />
                        <rect x="14" y="3" width="7" height="7" rx="1" />
                        <rect x="3" y="14" width="7" height="7" rx="1" />
                        <rect x="14" y="14" width="7" height="7" rx="1" />
                    </svg>
                    <span>Dashboard</span>
                </button>

                <div class="nav-section">Development</div>
                <button class="nav-item" data-page="sites">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M2 12h20" />
                        <path
                            d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                    </svg>
                    <span>Sites</span>
                </button>
                <button class="nav-item" data-page="services">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                    </svg>
                    <span>Services</span>
                </button>
                <button class="nav-item" data-page="php">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <ellipse cx="12" cy="12" rx="10" ry="6" />
                        <path d="M6 12l2-4h2l-1 2h1l1-2h2l-2 4" />
                    </svg>
                    <span>PHP</span>
                </button>

                <div class="nav-section">Tools</div>
                <button class="nav-item" data-page="dumps">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                    </svg>
                    <span>Dumps</span>
                </button>
                <button class="nav-item" data-page="mail">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                        <polyline points="22,6 12,13 2,6" />
                    </svg>
                    <span>Mail</span>
                </button>
                <button class="nav-item" data-page="logs">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <path d="M14 2v6h6" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10 9 9 9 8 9" />
                    </svg>
                    <span>Logs</span>
                </button>

                <div class="nav-section">Info</div>
                <button class="nav-item" data-page="changelog">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="12" y1="18" x2="12" y2="12" />
                        <line x1="9" y1="15" x2="15" y2="15" />
                    </svg>
                    <span>Change Log</span>
                </button>
                <button class="nav-item" data-page="about">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="12" y1="16" x2="12" y2="12" />
                        <line x1="12" y1="8" x2="12.01" y2="8" />
                    </svg>
                    <span>About</span>
                </button>
                <div class="nav-section">System</div>
                <button class="nav-item" data-page="settings">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                    <span>Settings</span>
                </button>
            </nav>
        </aside>

        <div class="status-bar">
            <div class="status-bar-item">
                <span class="server-status-dot"></span>
                <span id="server-status-text">Server running on :9999</span>
            </div>
        </div>

        <main class="main-content">
            <!-- Dashboard -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Overview of your development environment</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon sites">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <path d="M2 12h20" />
                            </svg>
                        </div>
                        <div class="stat-label">Sites</div>
                        <div class="stat-value" id="stat-sites">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon services">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                        </div>
                        <div class="stat-label">Running Services</div>
                        <div class="stat-value" id="stat-services">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon dumps">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                            </svg>
                        </div>
                        <div class="stat-label">Dumps</div>
                        <div class="stat-value" id="stat-dumps">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon php">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <ellipse cx="12" cy="12" rx="10" ry="6" />
                            </svg>
                        </div>
                        <div class="stat-label">PHP Version</div>
                        <div class="stat-value" id="stat-php">-</div>
                    </div>
                </div>

                <!-- Quick Access Grid -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- Recent Sites -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Recent Sites</span>
                            <button class="btn" onclick="showPage('sites')"
                                style="padding: 6px 12px; font-size: 12px;">View All</button>
                        </div>
                        <div class="card-body" id="recent-sites" style="padding: 0;"></div>
                    </div>

                    <!-- Quick Services -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Services</span>
                            <button class="btn" onclick="showPage('services')"
                                style="padding: 6px 12px; font-size: 12px;">Manage</button>
                        </div>
                        <div class="card-body" id="quick-services" style="padding: 16px;"></div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Quick Actions</span>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="showPage('sites'); setTimeout(() => addSite(), 100)">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="8" x2="12" y2="16" />
                                <line x1="8" y1="12" x2="16" y2="12" />
                            </svg>
                            Add New Site
                        </button>
                        <button class="btn btn-success" onclick="openTerminal()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="4 17 10 11 4 5" />
                                <line x1="12" y1="19" x2="20" y2="19" />
                            </svg>
                            Open Terminal
                        </button>
                        <button class="btn" onclick="location.reload()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="23 4 23 10 17 10" />
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
                            </svg>
                            Refresh
                        </button>
                        <button class="btn" onclick="showPage('services')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                            </svg>
                            Manage Services
                        </button>
                        <button class="btn" onclick="showPage('dumps')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                            </svg>
                            View Dumps
                        </button>
                        <button class="btn" onclick="showPage('mail')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                                <polyline points="22,6 12,13 2,6" />
                            </svg>
                            View Mail
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sites -->
            <div id="sites" class="page">
                <div class="page-header">
                    <h1 class="page-title">Sites</h1>
                    <p class="page-subtitle">Manage your local development sites</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">All Sites</span>
                        <button class="btn btn-primary" onclick="addSite()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                            Add Site
                        </button>
                    </div>
                    <div class="card-body" id="sites-list"></div>
                </div>
            </div>

            <!-- Services -->
            <div id="services" class="page">
                <div class="page-header">
                    <h1 class="page-title">Services</h1>
                    <p class="page-subtitle">Manage database and cache services</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">All Services</span>
                    </div>
                    <div class="card-body" id="services-list"></div>
                </div>
            </div>

            <!-- Dumps -->
            <div id="dumps" class="page">
                <div class="page-header">
                    <h1 class="page-title">Dumps</h1>
                    <p class="page-subtitle">View debug dumps from your applications</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">All Dumps</span>
                        <button class="btn btn-danger" onclick="clearDumps()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="3 6 5 6 21 6" />
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                            </svg>
                            Clear All
                        </button>
                    </div>
                    <div class="card-body" id="dumps-list"></div>
                </div>
            </div>

            <!-- Mail -->
            <div id="mail" class="page">
                <div class="page-header">
                    <h1 class="page-title">Mail</h1>
                    <p class="page-subtitle">Captured emails from your applications</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Inbox</span>
                        <button class="btn btn-danger" onclick="clearMail()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="3 6 5 6 21 6" />
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                            </svg>
                            Clear All
                        </button>
                    </div>
                    <div class="card-body" id="mail-list"></div>
                </div>
            </div>

            <!-- Logs -->
            <div id="logs" class="page">
                <div class="page-header">
                    <h1 class="page-title">Logs</h1>
                    <p class="page-subtitle">View and search application logs</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Log Files</span>
                    </div>
                    <div class="card-body" id="logs-list"></div>
                </div>
            </div>

            <!-- PHP -->
            <div id="php" class="page">
                <div class="page-header">
                    <h1 class="page-title">PHP Versions</h1>
                    <p class="page-subtitle">Manage installed PHP versions</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Installed Versions</span>
                        <button class="btn btn-primary" onclick="openInstallPHP()">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                            Install PHP
                        </button>
                    </div>
                    <div class="card-body" id="php-list"></div>
                </div>
            </div>

            <!-- Change Log -->
            <div id="changelog" class="page">
                <div class="page-header">
                    <h1 class="page-title">Change Log</h1>
                    <p class="page-subtitle">Stacker update history</p>
                </div>
                <div class="card">
                    <div class="card-body" style="padding: 32px;">
                        <div
                            style="border-left: 3px solid var(--accent); padding-left: 24px; margin-bottom: 40px; position: relative;">
                            <div
                                style="position: absolute; left: -8px; top: 0; width: 13px; height: 13px; background: var(--accent); border-radius: 50%; border: 3px solid var(--bg-secondary);">
                            </div>
                            <h3 style="margin-bottom: 8px; display: flex; align-items: center; gap: 12px;">
                                v1.0.1
                                <span class="status-badge"
                                    style="background: var(--accent-light); color: var(--accent); border: none;">Latest</span>
                            </h3>
                            <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">January 1, 2026
                            </p>
                            <ul style="padding-left: 18px; line-height: 2; color: var(--text-secondary);">
                                <li><strong>Composer Integration</strong>: Download and manage `composer.phar` directly.
                                </li>
                                <li><strong>Node.js Support</strong>: Install multiple Node.js versions with npm
                                    inclusion.</li>
                                <li><strong>Real-time Health Checks</strong>: Automatic service monitoring via PID and
                                    Port scanning.</li>
                                <li><strong>Custom Dialogs</strong>: Replaced browser alerts with modern, consistent UI
                                    modals.</li>
                                <li><strong>Aesthetic Refinements</strong>: Perfected toggle switches and layout
                                    spacing.</li>
                                <li><strong>New Info Hub</strong>: Added dedicated About and Change Log views.</li>
                            </ul>
                        </div>
                        <div style="border-left: 3px solid var(--border); padding-left: 24px; position: relative;">
                            <div
                                style="position: absolute; left: -8px; top: 0; width: 13px; height: 13px; background: var(--border); border-radius: 50%; border: 3px solid var(--bg-secondary);">
                            </div>
                            <h3 style="margin-bottom: 8px; color: var(--text-primary);">v1.0.0</h3>
                            <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">December 20, 2025
                            </p>
                            <ul style="padding-left: 18px; line-height: 2; color: var(--text-muted);">
                                <li>Initial standalone release with dynamic configuration.</li>
                                <li>Support for PHP, Nginx, Apache, MySQL, MariaDB, and Redis.</li>
                                <li>Basic site management and log viewing.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About -->
            <div id="about" class="page">
                <div class="page-header">
                    <h1 class="page-title">About</h1>
                    <p class="page-subtitle">System information and credits</p>
                </div>
                <div class="card" style="padding: 60px 40px; text-align: center;">
                    <div
                        style="background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)); width: 88px; height: 88px; border-radius: 22px; margin: 0 auto 28px; display: flex; align-items: center; justify-content: center; box-shadow: 0 12px 24px var(--shadow-lg);">
                        <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                        </svg>
                    </div>
                    <h2 style="font-size: 28px; margin-bottom: 12px; letter-spacing: -0.5px;">Stacker</h2>
                    <p style="color: var(--text-muted); font-size: 15px; margin-bottom: 32px;">Version 1.0.1 Stable
                        (macOS Edition)</p>

                    <p
                        style="max-width: 520px; margin: 0 auto 48px; line-height: 1.8; color: var(--text-secondary); font-size: 16px;">
                        Stacker is a modern, standalone development environment crafted for high-performance web
                        development.
                        It empowers developers to manage multiple PHP versions, databases, and servers without local
                        system dependencies.
                    </p>

                    <div
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; text-align: left; max-width: 440px; margin: 0 auto;">
                        <div
                            style="padding: 20px; background: var(--bg-tertiary); border-radius: 16px; border: 1px solid var(--border);">
                            <div
                                style="font-size: 11px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 6px; letter-spacing: 1px;">
                                Developer</div>
                            <div style="font-weight: 600; font-size: 15px;">Insya</div>
                        </div>
                        <div
                            style="padding: 20px; background: var(--bg-tertiary); border-radius: 16px; border: 1px solid var(--border);">
                            <div
                                style="font-size: 11px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 6px; letter-spacing: 1px;">
                                License</div>
                            <div style="font-weight: 600; font-size: 15px;">MIT Open Source</div>
                        </div>
                    </div>

                    <div style="margin-top: 48px;">
                        <a href="https://github.com/yasinkuyu/Stacker" target="_blank" class="btn"
                            style="padding: 12px 32px; border-radius: 12px; font-weight: 600;">View on GitHub</a>
                    </div>
                </div>
            </div>
            <!-- Settings -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Configure Stacker to your preferences</p>
                </div>

                <div class="card">
                    <div class="settings-section">
                        <div class="settings-section-title">General</div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">Automated Start</div>
                                <div class="settings-desc">Start services automatically when Stacker opens</div>
                            </div>
                            <button class="toggle-switch" id="auto-start-toggle" onclick="toggleAutoStart()"></button>
                        </div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">System Tray</div>
                                <div class="settings-desc">Minimize to system tray instead of closing</div>
                            </div>
                            <button class="toggle-switch" id="tray-toggle" onclick="toggleTray()"></button>
                        </div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">Slim Mode</div>
                                <div class="settings-desc">Compact sidebar for more screen space</div>
                            </div>
                            <button class="toggle-switch" id="slim-mode-toggle" onclick="toggleSlimMode()"></button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">Appearance</div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">Theme</div>
                                <div class="settings-desc">Choose your preferred interface style</div>
                            </div>
                            <div class="theme-toggle">
                                <button class="theme-btn" data-theme="light" onclick="setTheme('light')" title="Light">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="12" cy="12" r="5" />
                                        <line x1="12" y1="1" x2="12" y2="3" />
                                        <line x1="12" y1="21" x2="12" y2="23" />
                                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                                        <line x1="1" y1="12" x2="3" y2="12" />
                                        <line x1="21" y1="12" x2="23" y2="12" />
                                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                                    </svg>
                                </button>
                                <button class="theme-btn active" data-theme="dark" onclick="setTheme('dark')"
                                    title="Dark">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">Network</div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">Web UI Port</div>
                                <div class="settings-desc">Port used for this dashboard (requires reload)</div>
                            </div>
                            <div style="display:flex;gap:8px;">
                                <input type="number" class="input" id="port-input" value="9999" style="width:100px;">
                                <button class="btn btn-primary" onclick="savePort()">Save</button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-title">Support</div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">Check for Updates</div>
                                <div class="settings-desc">Currently running version 1.0.1</div>
                            </div>
                            <button class="btn" onclick="checkUpdates()">Check Now</button>
                        </div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <div class="settings-label">Maintenance</div>
                                <div class="settings-desc">Clean up temporary files and logs</div>
                            </div>
                            <div style="display:flex;gap:8px;">
                                <button class="btn" onclick="clearDumps()">Clear Dumps</button>
                                <button class="btn" onclick="clearMail()">Clear Mail</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>

    <!-- Draw Panel Overlay -->
    <div class="draw-panel-overlay" id="drawPanelOverlay" onclick="closeDrawPanel()"></div>

    <div class="draw-panel" id="drawPanel">
        <div class="draw-panel-header">
            <h2 class="draw-panel-title" id="drawPanelTitle">Title</h2>
            <button class="draw-panel-close" onclick="closeDrawPanel()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="draw-panel-body" id="drawPanelBody">
            <!-- Content dynamicly loaded -->
        </div>
        <div class="draw-panel-footer" id="drawPanelFooter">
            <button class="btn" onclick="closeDrawPanel()">Cancel</button>
            <button class="btn btn-primary" id="drawPanelSave">Save</button>
        </div>
    </div>

    <!-- Custom Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">Confirm</span>
                <button class="modal-close" id="modalClose">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modalMessage">
                Are you sure you want to proceed?
            </div>
            <div class="modal-footer">
                <button class="btn" id="modalCancel">Cancel</button>
                <button class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // UI & Navigation
        // ==========================================

        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => showPage(item.dataset.page));
        });

        // Custom Modal UI
        const customModal = {
            overlay: document.getElementById('modalOverlay'),
            title: document.getElementById('modalTitle'),
            message: document.getElementById('modalMessage'),
            confirmBtn: document.getElementById('modalConfirm'),
            cancelBtn: document.getElementById('modalCancel'),
            closeBtn: document.getElementById('modalClose'),

            show(options) {
                this.title.textContent = options.title || 'Confirm';
                this.message.innerHTML = options.message || '';
                this.confirmBtn.textContent = options.confirmText || 'Confirm';
                this.confirmBtn.className = 'btn ' + (options.type === 'danger' ? 'btn-danger' : 'btn-primary');

                if (options.hideCancel) {
                    this.cancelBtn.style.display = 'none';
                } else {
                    this.cancelBtn.style.display = 'block';
                    this.cancelBtn.textContent = options.cancelText || 'Cancel';
                }

                this.overlay.classList.add('open');

                return new Promise((resolve) => {
                    const onConfirm = () => {
                        this.overlay.classList.remove('open');
                        window.removeEventListener('keydown', onEsc);
                        resolve(true);
                    };
                    const onCancel = () => {
                        this.overlay.classList.remove('open');
                        window.removeEventListener('keydown', onEsc);
                        resolve(false);
                    };
                    const onEsc = (e) => { if (e.key === 'Escape') onCancel(); };

                    this.confirmBtn.onclick = onConfirm;
                    this.cancelBtn.onclick = onCancel;
                    this.closeBtn.onclick = onCancel;
                    this.overlay.onclick = (e) => { if (e.target === this.overlay) onCancel(); };
                    window.addEventListener('keydown', onEsc);
                });
            }
        };

        const ui = {
            confirm: (message, options = {}) => customModal.show({ message, ...options }),
            alert: (message, options = {}) => customModal.show({ message, hideCancel: true, confirmText: 'OK', ...options })
        };

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            const page = document.getElementById(pageId);
            if (page) page.classList.add('active');

            const nav = document.querySelector('[data-page="' + pageId + '"]');
            if (nav) nav.classList.add('active');

            window.location.hash = pageId;
            loadPage(pageId);
        }

        async function api(endpoint, method = 'GET', data = null) {
            try {
                const options = { method };
                if (data) {
                    options.headers = { 'Content-Type': 'application/json' };
                    options.body = JSON.stringify(data);
                }
                const res = await fetch('/api' + endpoint, options);
                if (!res.ok) {
                    const error = await res.json().catch(() => ({}));
                    throw new Error(error.message || `API error: ${res.status}`);
                }
                return res.json();
            } catch (err) {
                console.error('API Error:', err);
                throw err;
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toast.className = 'toast show ' + type;
            toastMessage.textContent = message;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==========================================
        // Data Loading
        // ==========================================

        async function loadPage(pageId) {
            switch (pageId) {
                case 'dashboard': await loadStatus(); break;
                case 'sites': await loadSites(); break;
                case 'services': await loadServices(); break;
                case 'dumps': await loadDumps(); break;
                case 'mail': await loadMail(); break;
                case 'logs': await loadLogs(); break;
                case 'php': await loadPHP(); break;
                case 'settings': await loadSettings(); break;
            }
        }

        async function loadPHP() {
            const list = document.getElementById('php-list');

            // Show loading spinner
            list.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; gap: 16px;">
                    <div class="spinner"></div>
                    <span style="color: var(--text-muted); font-size: 13px;">Loading PHP versions...</span>
                </div>
            `;

            try {
                const data = await api('/php');
                if (!data || !data.versions || data.versions.length === 0) {
                    list.innerHTML = `
                        <div class="empty-state" style="padding: 40px; text-align: center;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5" style="margin-bottom: 16px;">
                                <ellipse cx="12" cy="12" rx="10" ry="6"/>
                                <path d="M5.5 8.5l2.5 7h2l1-3h2l1 3h2l2.5-7"/>
                            </svg>
                            <h3 style="color: var(--text-muted); margin-bottom: 8px;">No PHP Versions Installed</h3>
                            <p style="color: var(--text-muted); font-size: 13px;">Click "Install PHP" to add a version.</p>
                        </div>
                    `;
                    return;
                }

                list.innerHTML = data.versions.map(v => `
                    <div class="list-item" style="padding: 16px 24px;">
                        <div class="service-info">
                            <div class="service-icon php" style="background: linear-gradient(135deg, #8892bf 0%, #4f5b93 100%); width: 36px; height: 36px;">
                                <span style="font-weight: 700; font-size: 12px; color: white;">PHP</span>
                            </div>
                            <div>
                                <div class="service-name">PHP ${v.version}</div>
                                <div class="service-port" style="font-size: 12px; color: var(--text-muted);">${v.path}</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            ${v.has_xdebug ? '<span class="status-badge" style="background: var(--success-bg); color: var(--success);">XDebug</span>' : ''}
                            ${v.default ? '<span class="status-badge" style="background: var(--accent-light); color: var(--accent);">Default</span>' : ''}
                            <button class="btn" onclick="setPHPVersion('${v.version}')" ${v.default ? 'disabled' : ''}>
                                ${v.default ? 'Active' : 'Set Default'}
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Error loading PHP versions:', err);
                list.innerHTML = '<div class="empty-state" style="padding: 20px; color: var(--danger);">Error loading PHP versions</div>';
            }
        }

        async function loadStatus() {
            try {
                const data = await api('/status');
                if (data) {
                    document.getElementById('stat-sites').textContent = data.sites || 0;
                    document.getElementById('stat-services').textContent = data.services || 0;
                    document.getElementById('stat-dumps').textContent = data.dumps || 0;
                    document.getElementById('stat-php').textContent = data.php || '-';

                    // Update server status text
                    const statusDot = document.querySelector('.server-status-dot');
                    const statusText = document.getElementById('server-status-text');
                    statusDot.style.background = '#10b981'; // green
                    statusText.textContent = 'Server running on :9999';

                    // Load recent sites
                    const recentSitesEl = document.getElementById('recent-sites');
                    recentSitesEl.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px 20px; gap: 12px;">
                            <div class="spinner" style="width: 24px; height: 24px; border-width: 2px;"></div>
                            <span style="color: var(--text-muted); font-size: 11px;">Loading sites...</span>
                        </div>
                    `;
                    const sites = await api('/sites');
                    if (sites && sites.length) {
                        recentSitesEl.innerHTML = sites.slice(0, 5).map(s => `
                            <div class="list-item" style="padding: 12px 16px;">
                                <div class="item-info">
                                    <div class="item-primary" style="display: flex; align-items: center; gap: 8px;">
                                        ${s.name}.test
                                        ${s.php ? `<span class="site-badge php" style="font-size: 9px; padding: 2px 6px;">PHP ${s.php}</span>` : ''}
                                    </div>
                                    <div class="item-secondary" style="font-size: 12px;">${s.path}</div>
                                </div>
                                <button class="icon-btn" onclick="openSiteInBrowser('${s.name}')" title="Open in browser">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                        <polyline points="15 3 21 3 21 9"/>
                                        <line x1="10" y1="14" x2="21" y2="3"/>
                                    </svg>
                                </button>
                            </div>
                        `).join('');
                    } else {
                        recentSitesEl.innerHTML = '<div style="padding: 24px; text-align: center; color: var(--text-muted);">No sites configured</div>';
                    }

                    // Load quick services
                    const quickServicesEl = document.getElementById('quick-services');
                    quickServicesEl.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px 20px; gap: 12px;">
                            <div class="spinner" style="width: 24px; height: 24px; border-width: 2px;"></div>
                            <span style="color: var(--text-muted); font-size: 11px;">Loading services...</span>
                        </div>
                    `;
                    const servicesData = await api('/services');
                    if (servicesData && servicesData.installed) {
                        const installed = servicesData.installed;
                        if (installed.length) {
                            quickServicesEl.innerHTML = installed.slice(0, 5).map(s => `
                                <div class="list-item" style="padding: 10px 0; border-bottom: none;">
                                    <div class="item-info">
                                        <div class="item-primary" style="font-size: 13px; font-weight: 600;">${s.type.toUpperCase()} ${s.version}</div>
                                        <div class="item-secondary" style="font-size: 11px; color: var(--text-muted);">Port: ${s.port || 'Default'}</div>
                                    </div>
                                    <span class="status-badge status-${s.status}" style="padding: 4px 8px; font-size: 10px; margin-right: 8px;">
                                        <span class="status-dot"></span>${s.status}
                                    </span>
                                    <button class="btn" onclick="${s.status === 'running' ? `stopService('${s.name}')` : `startService('${s.name}')`}" 
                                        style="width: 32px; height: 32px; padding: 0; justify-content: center;" 
                                        title="${s.status === 'running' ? 'Stop' : 'Start'}">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                            ${s.status === 'running'
                                    ? '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>'
                                    : '<polygon points="5 3 19 12 5 21 5 3"/>'}
                                        </svg>
                                    </button>
                                </div>
                            `).join('');
                        } else {
                            quickServicesEl.innerHTML = '<div style="padding: 16px; text-align: center; color: var(--text-muted);">No services installed yet.</div>';
                        }
                    }
                }
            } catch (err) { console.error(err); }
        }

        // ==========================================
        // Settings & Actions
        // ==========================================

        async function loadSettings() {
            try {
                const prefs = await api('/preferences');
                if (prefs) {
                    document.documentElement.setAttribute('data-theme', prefs.theme);
                    document.querySelectorAll('.theme-btn').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.theme === prefs.theme);
                    });
                    document.getElementById('auto-start-toggle').classList.toggle('active', prefs.autoStart);
                    document.getElementById('tray-toggle').classList.toggle('active', prefs.showTray);
                    document.getElementById('port-input').value = prefs.port || 9999;
                    if (document.getElementById('slim-mode-toggle')) {
                        document.getElementById('slim-mode-toggle').classList.toggle('active', prefs.slimMode);
                        setSlimMode(prefs.slimMode);
                    }
                }
            } catch (err) { }
        }

        async function setTheme(theme) {
            try {
                await api('/preferences', 'PUT', { theme });
                document.documentElement.setAttribute('data-theme', theme);
                document.querySelectorAll('.theme-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.theme === theme);
                });
                showToast('Theme changed to ' + theme);
            } catch (err) { showToast(err.message, 'error'); }
        }

        async function toggleAutoStart() {
            const toggle = document.getElementById('auto-start-toggle');
            const newState = !toggle.classList.contains('active');
            try {
                await api('/preferences', 'PUT', { autoStart: newState });
                toggle.classList.toggle('active', newState);
                showToast(newState ? 'Auto-start enabled' : 'Auto-start disabled');
            } catch (err) { showToast(err.message, 'error'); }
        }

        async function toggleTray() {
            const toggle = document.getElementById('tray-toggle');
            const newState = !toggle.classList.contains('active');
            try {
                await api('/preferences', 'PUT', { showTray: newState });
                toggle.classList.toggle('active', newState);
                showToast(newState ? 'Tray icon enabled' : 'Tray icon disabled');
            } catch (err) { showToast(err.message, 'error'); }
        }

        async function toggleSlimMode() {
            const toggle = document.getElementById('slim-mode-toggle');
            const newState = !toggle.classList.contains('active');
            try {
                await api('/preferences', 'PUT', { slimMode: newState });
                toggle.classList.toggle('active', newState);
                setSlimMode(newState);
                showToast(newState ? 'Slim mode enabled' : 'Slim mode disabled');
            } catch (err) { showToast(err.message, 'error'); }
        }

        function setSlimMode(enabled) {
            document.body.setAttribute('data-slim', enabled ? 'true' : 'false');
            localStorage.setItem('stacker_slimMode', enabled);
        }

        // Load slim mode on startup
        (function () {
            const slimMode = localStorage.getItem('stacker_slimMode') === 'true';
            if (slimMode) {
                document.body.setAttribute('data-slim', 'true');
            }
        })();

        async function savePort() {
            const port = parseInt(document.getElementById('port-input').value);
            if (port < 1024 || port > 65535) {
                showToast('Port must be between 1024 and 65535', 'error');
                return;
            }
            try {
                await api('/preferences', 'PUT', { port });
                showToast('Port saved! Restart to apply.');
            } catch (err) { showToast(err.message, 'error'); }
        }

        async function checkUpdates() {
            try {
                showToast('Checking for updates...');
                const res = await fetch('https://raw.githubusercontent.com/yasinkuyu/Stacker/main/update.json');
                if (!res.ok) throw new Error('Failed to fetch');
                const data = await res.json();
                const currentVersion = '1.0.1'; // This should match app version
                const remoteVersion = data.stacker.version;
                if (remoteVersion !== currentVersion) {
                    showToast(`New version ${remoteVersion} available!`, 'info');
                    if (await ui.confirm(`New version ${remoteVersion} is available!\n\n${data.stacker.changelog}\n\nWould you like to download it?`)) {
                        window.open(data.stacker.downloadUrl, '_blank');
                    }
                } else {
                    showToast('You are running the latest version');
                }
            } catch (err) {
                showToast('Could not check for updates', 'error');
            }
        }

        // Actions
        async function clearDumps() {
            if (await ui.confirm('Clear all dumps?', { type: 'danger' })) {
                try {
                    await api('/dumps', 'DELETE');
                    loadDumps();
                    showToast('Dumps cleared');
                } catch (err) { showToast(err.message, 'error'); }
            }
        }

        async function clearMail() {
            if (await ui.confirm('Clear all emails?', { type: 'danger' })) {
                try {
                    await api('/mail', 'DELETE');
                    loadMail();
                    showToast('Emails cleared');
                } catch (err) { showToast(err.message, 'error'); }
            }
        }

        async function openTerminal() {
            await api('/open-terminal', 'POST', { path: "" });
        }

        async function setPHPVersion(version) {
            await api('/php/default', 'PUT', { version });
            showToast('PHP version set to ' + version);
            loadPHP();
        }

        // ==========================================
        // Draw Panel Functions
        // ==========================================

        let currentPanel = null;
        let currentSite = null;

        function openDrawPanel(title, content, onSave, saveText = 'Save', wide = false) {
            document.getElementById('drawPanelTitle').textContent = title;
            document.getElementById('drawPanelBody').innerHTML = content;
            document.getElementById('drawPanelOverlay').classList.add('open');
            const panel = document.getElementById('drawPanel');
            panel.classList.add('open');
            if (wide) panel.classList.add('wide');
            else panel.classList.remove('wide');

            const saveBtn = document.getElementById('drawPanelSave');
            saveBtn.style.display = onSave ? 'block' : 'none';
            if (onSave) {
                saveBtn.textContent = saveText;
                saveBtn.onclick = onSave;
            }
            document.getElementById('drawPanelFooter').style.display = 'flex';
            currentPanel = { title, onSave };
        }

        function closeDrawPanel() {
            document.getElementById('drawPanelOverlay').classList.remove('open');
            const panel = document.getElementById('drawPanel');
            panel.classList.remove('open');
            panel.classList.remove('wide');
            currentPanel = null;
            currentSite = null;
        }

        // ==========================================
        // Site Management
        // ==========================================

        async function loadSites() {
            const list = document.getElementById('sites-list');
            try {
                const sites = await api('/sites');
                if (!sites || !sites.length) {
                    list.innerHTML = '<div class="empty-state"><p>No sites configured</p></div>';
                    return;
                }
                list.innerHTML = sites.map(s => `
                    <div class="site-row">
                        <div class="site-info" onclick='editSite(${JSON.stringify(s)})'>
                            <div class="site-name">${s.name}.test</div>
                            <div class="site-path">${s.path}</div>
                        </div>
                        <div class="site-badges">
                            ${s.php ? `<span class="site-badge php">PHP ${s.php}</span>` : ''}
                            ${s.ssl ? '<span class="site-badge ssl">SSL</span>' : ''}
                        </div>
                        <div class="site-actions">
                            <button class="icon-btn" onclick="openSiteInBrowser('${s.name}')" title="Open"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg></button>
                            <button class="icon-btn" onclick="openSiteFolder('${s.path}')" title="Folder"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg></button>
                            <button class="icon-btn danger" onclick="deleteSite('${s.name}')" title="Delete"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
                        </div>
                    </div>
                `).join('');
            } catch (err) { }
        }

        async function addSite() {
            const data = await api('/php').catch(() => ({ versions: [] }));
            const phpVersions = data && data.versions ? data.versions : [];
            const phpOptions = phpVersions.map(v =>
                `<option value="${v.version}">PHP ${v.version}${v.default ? ' (Default)' : ''}</option>`
            ).join('');

            const content = `
                <div class="form-group">
                    <label class="form-label">Site Name</label>
                    <input type="text" class="form-input" id="siteName" placeholder="my-project">
                    <div class="form-hint">Will be accessible at my-project.test</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Project Path</label>
                    <div style="display:flex;gap:8px;">
                        <input type="text" class="form-input" id="sitePath" placeholder="/Users/you/Sites/my-project" style="flex:1;">
                        <button class="btn" onclick="browsePath()">Browse</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">PHP Version</label>
                    <select class="form-select" id="sitePhp">
                        <option value="">Use Default</option>
                        ${phpOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Options</label>
                    <div class="settings-row" style="padding:12px 0;border:none;">
                        <div class="settings-info">
                            <div class="settings-label">Enable SSL</div>
                            <div class="settings-desc">Serve site over HTTPS</div>
                        </div>
                        <button class="toggle-switch active" id="siteSsl" onclick="this.classList.toggle('active')"></button>
                    </div>
                </div>
            `;

            openDrawPanel('Add New Site', content, saveSite);
        }

        async function editSite(site) {
            currentSite = site;
            const data = await api('/php').catch(() => ({ versions: [] }));
            const phpVersions = data && data.versions ? data.versions : [];
            const phpOptions = phpVersions.map(v =>
                `<option value="${v.version}" ${site.php === v.version ? 'selected' : ''}>PHP ${v.version}${v.default ? ' (Default)' : ''}</option>`
            ).join('');

            const content = `
                <div class="form-group">
                    <label class="form-label">Site Name</label>
                    <input type="text" class="form-input" id="siteName" value="${site.name}">
                </div>
                <div class="form-group">
                    <label class="form-label">Project Path</label>
                    <input type="text" class="form-input" id="sitePath" value="${site.path}">
                </div>
                <div class="form-group">
                    <label class="form-label">PHP Version</label>
                    <select class="form-select" id="sitePhp">
                        <option value="">Use Default</option>
                        ${phpOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Options</label>
                    <div class="settings-row" style="padding:12px 0;border:none;">
                        <div class="settings-info">
                            <div class="settings-label">Enable SSL</div>
                        </div>
                        <button class="toggle-switch ${site.ssl ? 'active' : ''}" id="siteSsl" onclick="this.classList.toggle('active')"></button>
                    </div>
                </div>
                <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border);">
                    <button class="btn btn-danger" onclick="deleteSite('${site.name}')">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Delete Site
                    </button>
                </div>
            `;

            openDrawPanel('Edit Site: ' + site.name, content, updateSite);
        }

        async function saveSite() {
            const name = document.getElementById('siteName').value.trim();
            const path = document.getElementById('sitePath').value.trim();
            const php = document.getElementById('sitePhp').value;
            const ssl = document.getElementById('siteSsl').classList.contains('active');

            if (!name || !path) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            try {
                await api('/sites', 'POST', { name, path, php, ssl });
                closeDrawPanel();
                showToast('Site added successfully');
                loadSites();
            } catch (err) { showToast(err.message, 'error'); }
        }

        async function updateSite() {
            const name = document.getElementById('siteName').value.trim();
            const path = document.getElementById('sitePath').value.trim();
            const php = document.getElementById('sitePhp').value;
            const ssl = document.getElementById('siteSsl').classList.contains('active');

            try {
                await api('/sites/' + currentSite.name, 'PUT', { name, path, php, ssl });
                closeDrawPanel();
                showToast('Site updated successfully');
                loadSites();
            } catch (err) { showToast(err.message, 'error'); }
        }

        async function deleteSite(name) {
            if (await ui.confirm('Are you sure you want to delete this site?', { type: 'danger' })) {
                try {
                    await api('/sites/' + name, 'DELETE');
                    closeDrawPanel();
                    showToast('Site deleted');
                    loadSites();
                } catch (err) { showToast(err.message, 'error'); }
            }
        }

        function openSiteInBrowser(name) {
            window.open('https://' + name + '.test', '_blank');
        }

        async function openSiteFolder(path) {
            await api('/open-folder', 'POST', { path });
        }

        async function browsePath() {
            const res = await api('/browse-folder');
            if (res && res.path) {
                document.getElementById('sitePath').value = res.path;
                // If it's a new site and name is empty, try to guess name from path
                const nameInput = document.getElementById('siteName');
                if (nameInput && !nameInput.value) {
                    nameInput.value = res.path.split('/').pop().toLowerCase().replace(/[^a-z0-9]/g, '-');
                }
            }
        }

        async function openTerminal(path = "") {
            // If path is empty string (Default Terminal button), use home or stacker dir
            await api('/open-terminal', 'POST', { path });
        }

        // ==========================================
        // Server Configuration
        // ==========================================

        function openServerConfig() {
            const content = `
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab(this, 'nginx-tab')">Nginx</button>
                    <button class="tab-btn" onclick="switchTab(this, 'mysql-tab')">MySQL</button>
                    <button class="tab-btn" onclick="switchTab(this, 'redis-tab')">Redis</button>
                </div>
                
                <div id="nginx-tab" class="tab-content active">
                    <div class="service-card">
                        <div class="service-info">
                            <div class="service-icon nginx">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="service-name">Nginx</div>
                                <div class="service-port">Port: 80, 443</div>
                            </div>
                        </div>
                        <div class="service-actions">
                            <span class="status-badge status-running"><span class="status-dot"></span>Running</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">HTTP Port</label>
                        <input type="number" class="form-input" id="nginxPort" value="80">
                    </div>
                    <div class="form-group">
                        <label class="form-label">HTTPS Port</label>
                        <input type="number" class="form-input" id="nginxSslPort" value="443">
                    </div>
                </div>
                
                <div id="mysql-tab" class="tab-content">
                    <div class="service-card">
                        <div class="service-info">
                            <div class="service-icon mysql">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/><path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3"/>
                                </svg>
                            </div>
                            <div>
                                <div class="service-name">MySQL</div>
                                <div class="service-port">Port: 3306</div>
                            </div>
                        </div>
                        <div class="service-actions">
                            <button class="toggle-switch active" id="mysqlToggle"></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Port</label>
                        <input type="number" class="form-input" id="mysqlPort" value="3306">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Root Password</label>
                        <input type="password" class="form-input" id="mysqlPassword" placeholder="">
                    </div>
                </div>
                
                <div id="redis-tab" class="tab-content">
                    <div class="service-card">
                        <div class="service-info">
                            <div class="service-icon redis">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                            </div>
                            <div>
                                <div class="service-name">Redis</div>
                                <div class="service-port">Port: 6379</div>
                            </div>
                        </div>
                        <div class="service-actions">
                            <button class="toggle-switch" id="redisToggle"></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Port</label>
                        <input type="number" class="form-input" id="redisPort" value="6379">
                    </div>
                </div>
            `;

            openDrawPanel('Server Configuration', content, saveServerConfig);
        }

        function switchTab(btn, tabId) {
            btn.parentElement.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        async function saveServerConfig() {
            showToast('Server configuration saved');
            closeDrawPanel();
        }

        // ==========================================
        // PHP Installation
        // ==========================================

        function openInstallPHP() {
            const content = `
                <div style="padding: 16px; text-align: center; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 16px;">
                    <div style="font-size: 24px; margin-bottom: 12px;"></div>
                    <div style="font-weight: 600; margin-bottom: 8px;">Install PHP (Standalone)</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">Downloads pre-built static PHP binaries. No Homebrew or system dependencies required.</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Select PHP Version</label>
                    <select class="form-select" id="installPhpVersion">
                        <option value="8.4">PHP 8.4 (Latest)</option>
                        <option value="8.3" selected>PHP 8.3 (Recommended)</option>
                        <option value="8.2">PHP 8.2 (LTS)</option>
                        <option value="8.1">PHP 8.1</option>
                        <option value="8.0">PHP 8.0</option>
                    </select>
                    <div class="form-hint">PHP will be downloaded from static-php.dev (no external dependencies)</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Options</label>
                    <div class="settings-row" style="padding:12px 0;border:none;">
                        <div class="settings-info">
                            <div class="settings-label">Enable XDebug</div>
                            <div class="settings-desc">Include debugging support (larger download)</div>
                        </div>
                        <button class="toggle-switch" id="installXdebug" onclick="this.classList.toggle('active')"></button>
                    </div>
                </div>

                <div style="padding: 12px; background: var(--success-bg); border-radius: 8px; margin-top: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; color: var(--success);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        <span style="font-weight: 600;">100% Standalone</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">No Homebrew, apt, or any package manager needed</div>
                </div>
            `;

            openDrawPanel('Install PHP', content, installPHP, 'Install');
        }

        function copyCommand(command) {
            navigator.clipboard.writeText(command);
            showToast('Command copied to clipboard');
        }

        async function installPHP() {
            const version = document.getElementById('installPhpVersion').value;
            const xdebug = document.getElementById('installXdebug').classList.contains('active');

            // Hide footer during install
            document.getElementById('drawPanelFooter').style.display = 'none';

            // Show progress in panel body
            const body = document.getElementById('drawPanelBody');
            body.innerHTML = `
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Installing PHP ${version}</span>
                        <span id="installPercent">0%</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="installProgressFill"></div>
                    </div>
                    <div class="install-log" id="installLog">
                        Starting download...<br>
                    </div>
                </div>
            `;

            // Start installation
            api('/php/install', 'POST', { version, xdebug });

            // Poll progress
            const log = document.getElementById('installLog');
            const fill = document.getElementById('installProgressFill');
            const perc = document.getElementById('installPercent');

            let progress = 0;
            const interval = setInterval(async () => {
                const status = await api(`/php/install-status?version=${version}`);
                if (status && status.progress !== undefined) {
                    progress = status.progress;

                    // Check for error
                    if (progress === -1) {
                        clearInterval(interval);
                        log.innerHTML += `<span style="color:#ef4444;"> Error: Failed to download PHP ${version}<br>`;
                        log.innerHTML += `<span style="color:#fbbf24;"> Please try a different version or check your internet connection</span><br>`;
                        perc.textContent = 'Error';
                        fill.style.width = '100%';
                        fill.style.background = '#ef4444';
                        return;
                    }

                    fill.style.width = progress + '%';
                    perc.textContent = progress + '%';

                    if (progress > 0 && progress < 100) {
                        log.innerHTML = `Downloading PHP binary... ${progress}%<br>`;
                    } else if (progress === 100) {
                        log.innerHTML += `Extracting files...<br>`;
                        log.innerHTML += `Finalizing installation...<br>`;
                        clearInterval(interval);

                        setTimeout(() => {
                            showToast('PHP ' + version + ' installed successfully');
                            closeDrawPanel();
                            loadPHP();
                        }, 1000);
                    }
                }
            }, 1000);
        }


        // ==========================================
        // Service Management
        // ==========================================

        let operationModal = null;

        function showOperationProgress(message) {
            operationModal = document.createElement('div');
            operationModal.className = 'modal-overlay';
            operationModal.style.display = 'flex';
            operationModal.innerHTML = `
                <div class="modal" style="max-width: 300px; text-align: center;">
                    <div style="margin-bottom: 16px;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" style="animation: spin 1s linear infinite;">
                            <circle cx="12" cy="12" r="10" stroke-opacity="0.2"/>
                            <path d="M12 2a10 10 0 0 1 10 10"/>
                        </svg>
                    </div>
                    <div style="font-weight: 500;">${message}</div>
                </div>
            `;
            document.body.appendChild(operationModal);
        }

        function hideOperationProgress() {
            if (operationModal) {
                operationModal.remove();
                operationModal = null;
            }
        }

        async function startService(name) {
            showOperationProgress(`Starting ${name}...`);
            try {
                const data = await api('/services');
                const svc = data.installed.find(s => s.name === name);

                await api(`/services/start/${name}`, 'POST');
                hideOperationProgress();
                showToast(`${name} started`);

                if (svc) {
                    showActionProgress(`Starting ${name}`, svc.type, svc.version);
                } else {
                    loadServices();
                }
            } catch (err) {
                hideOperationProgress();
                showToast(err.message, 'error');
            }
        }

        async function stopService(name) {
            showOperationProgress(`Stopping ${name}...`);
            try {
                await api(`/services/stop/${name}`, 'POST');
                hideOperationProgress();
                showToast(`${name} stopped`);
                loadServices();
            } catch (err) {
                hideOperationProgress();
                showToast(err.message, 'error');
            }
        }

        async function restartService(name) {
            showOperationProgress(`Restarting ${name}...`);
            try {
                await api(`/services/restart/${name}`, 'POST');
                hideOperationProgress();
                showToast(`${name} restarted`);
                loadServices();
            } catch (err) {
                hideOperationProgress();
                showToast(err.message, 'error');
            }
        }

        async function editServiceConfig(name) {
            showOperationProgress(`Loading config...`);
            try {
                const config = await api(`/services/config/${name}`);
                hideOperationProgress();
                if (!config || !config.content) {
                    showToast('Config not available', 'error');
                    return;
                }

                openDrawPanel(`Config: ${name}`, `
                    <div style="display: flex; flex-direction: column; height: 100%;">
                        <div style="margin-bottom: 12px; color: var(--text-muted); font-size: 12px;">
                             ${config.path}
                        </div>
                        <textarea id="config-editor" style="flex: 1; width: 100%; min-height: 400px; padding: 12px; font-family: 'SF Mono', Monaco, monospace; font-size: 12px; line-height: 1.5; background: var(--bg-tertiary); color: var(--text); border: 1px solid var(--border); border-radius: 8px; resize: none;">${config.content}</textarea>
                        <div style="margin-top: 12px; display: flex; gap: 12px; justify-content: flex-end;">
                            <button class="btn" onclick="closeDrawPanel()">Cancel</button>
                            <button class="btn btn-primary" id="save-config-btn" onclick="saveServiceConfig('${name}')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Save & Restart
                            </button>
                        </div>
                    </div>
                `, null, null, true);
            } catch (err) {
                hideOperationProgress();
                showToast(err.message, 'error');
            }
        }

        async function saveServiceConfig(name) {
            const content = document.getElementById('config-editor').value;
            const btn = document.getElementById('save-config-btn');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;"><circle cx="12" cy="12" r="10"/></svg> Saving...';
            }
            try {
                await api(`/services/config/${name}`, 'POST', { content });
                showToast('Config saved & service restarted');
                closeDrawPanel();
                loadServices();
            } catch (err) {
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = 'Save & Restart';
                }
                showToast(err.message, 'error');
            }
        }

        async function uninstallService(name) {
            if (await ui.confirm(`Uninstall ${name}? All data will be lost.`, { type: 'danger' })) {
                try {
                    const data = await api('/services');
                    const svc = data.installed.find(s => s.name === name);

                    await api('/services/uninstall', 'POST', { name });
                    showToast(`${name} uninstallation started...`);

                    if (svc) {
                        showActionProgress(`Uninstalling ${name}`, svc.type, svc.version, true);
                    } else {
                        loadServices();
                        loadStatus();
                    }
                } catch (err) { showToast(err.message, 'error'); }
            }
        }

        function showActionProgress(title, type, version, reloadStatus = false) {
            openDrawPanel(title, `
                <div class="progress-container">
                    <div class="progress-label">
                        <span>${title}</span>
                        <span id="action-percent">0%</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="action-fill"></div>
                    </div>
                    <div class="install-log" id="action-log">Processing...</div>
                </div>
            `, null, 'Close');

            const interval = setInterval(async () => {
                const status = await api(`/services/install-status?type=${type}&version=${version}`);
                if (status) {
                    const progress = status.progress;
                    const error = status.error;
                    if (progress === -1) {
                        clearInterval(interval);
                        document.getElementById('action-log').innerHTML = `<span style="color: var(--danger);">Operation failed: ${error || 'Unknown error'}</span>`;
                        return;
                    }
                    document.getElementById('action-fill').style.width = progress + '%';
                    document.getElementById('action-percent').textContent = progress + '%';
                    if (progress === 100) {
                        clearInterval(interval);
                        document.getElementById('action-log').textContent = 'Completed!';
                        setTimeout(() => {
                            closeDrawPanel();
                            loadServices();
                            if (reloadStatus) loadStatus();
                        }, 1000);
                    }
                }
            }, 800);
        }

        async function loadServices() {
            const list = document.getElementById('services-list');

            // Show loading spinner
            list.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; gap: 16px;">
                    <div class="spinner"></div>
                    <span style="color: var(--text-muted); font-size: 13px;">Loading services...</span>
                </div>
            `;

            try {
                const data = await api('/services');
                if (!data) return;

                const installed = data.installed || [];
                const available = data.available || [];
                const installedVersions = data.installedVersions || [];

                // Group available by type
                const availableByType = {};
                available.forEach(v => {
                    if (!availableByType[v.type]) availableByType[v.type] = [];
                    const isInstalled = installedVersions.includes(v.type + '-' + v.version);
                    availableByType[v.type].push({ version: v.version, installed: isInstalled });
                });

                let html = `
                    <div style="padding: 24px;">
                        <div style="margin-bottom: 32px;">
                            <h3 style="margin-bottom: 16px; font-size: 14px; text-transform: uppercase; color: var(--text-muted);">Installed Services</h3>
                            ${installed.length === 0 ? '<div class="empty-state" style="padding: 20px;"><p>No services installed</p></div>' : installed.map(s => `
                                <div class="service-card">
                                    <div class="service-info">
                                        <div class="service-icon ${s.type}">
                                            ${s.type === 'mysql' ? '<svg viewBox="0 0 128 128"><path fill="#00618A" d="M116.948 97.807c-6.863-.187-12.104.452-16.585 2.341-1.273.537-3.305.552-3.513 2.147.7.733.807 1.83 1.365 2.731 1.07 1.73 2.876 4.052 4.488 5.268 1.762 1.33 3.577 2.751 5.465 3.902 3.358 2.047 7.107 3.217 10.34 5.268 1.906 1.21 3.799 2.733 5.658 4.097.92.675 1.537 1.724 2.732 2.147v-.194c-.628-.79-.79-1.898-1.366-2.733l-2.537-2.537c-2.48-3.292-5.629-6.184-8.976-8.585-2.669-1.916-8.642-4.504-9.755-7.609l-.195-.195c1.892-.214 4.107-.898 5.854-1.367 2.934-.786 5.556-.583 8.585-1.365l4.097-1.171v-.78c-1.531-1.571-2.623-3.651-4.292-5.073-4.37-3.72-9.138-7.437-14.048-10.537-2.724-1.718-6.089-2.835-8.976-4.292-.971-.491-2.677-.746-3.318-1.562-1.517-1.932-2.342-4.382-3.511-6.633-2.449-4.717-4.854-9.868-7.024-14.831-1.48-3.384-2.447-6.72-4.292-9.756-8.86-14.567-18.396-23.358-33.169-32-3.144-1.838-6.929-2.563-10.929-3.513l-6.438-.389c-1.309-.547-2.676-2.149-3.902-2.927C11.931 4.319 5.3.625 1.907 4.411c-2.14 2.389.247 4.817 1.171 7.219.653 1.698 1.316 3.405 2.147 5.073.566 1.136 1.316 2.229 1.757 3.317 1.13 2.79 1.655 5.844 2.927 8.585 2.47 5.323 4.86 10.889 8.195 15.61 1.669 2.363 3.044 4.81 5.073 6.829 1.231 1.225 3.31 1.993 4.097 3.708-2.308 3.225-2.442 7.547-3.902 11.318-6.577 16.978-4.098 38.121 5.463 50.712 2.935 3.868 9.834 12.166 19.318 8.976 8.303-2.789 6.447-11.438 8.78-19.122 1.296-4.274 1.166-7.455 2.733-10.73-.095-.048-.097-.021-.195.194v.584c-1.452 2.927-3.053 5.79-4.29 8.975-1.807 4.653-2.818 9.803-4.489 14.44-.621 1.722-1.66 4.413-3.122 5.462-2.854 2.046-8.982.99-11.903-.195-2.47-.988-5.089-2.656-7.024-4.097-3.976-2.961-7.496-6.631-10.538-10.538-7.419-9.523-13.106-20.193-15.22-32.392-.595-3.455-.503-6.896-1.171-10.342-.658-9.37 2.19-17.16 5.072-23.36 3.055-6.571 8.125-12.965 12.899-17.952 2.554-2.668 5.554-4.858 8.585-6.829 2.565-1.669 4.977-2.888 7.804-3.902 1.131-.406 2.932-.298 3.513-1.171v-.78c-2.019-.195-3.905-.911-5.854-1.367-3.244-.758-6.127-.389-9.365-1.17-6.685-1.612-13.322-4.098-19.513-6.439-3.239-1.225-6.498-1.79-9.366-2.537-2.915-.76-5.817-1.832-8.78-2.146l-1.757-1.171c-.65-.709-.79-2.21-1.171-3.122z"/><path fill="#F29111" d="M52.767 43.76c-2.095.195-3.615.633-5.263 1.366v.389l2.342 2.342c1.414 1.464 2.971 3.53 4.293 4.682l.977.195c.934-.462 1.665-1.195 2.342-1.952 1.892-2.114 3.739-5.002 5.073-7.609l.39-.78h-.585c-.9.561-1.665.973-2.731 1.366-2.256.833-4.82.833-7.024.797-2.095 0-4.295.389-5.268-.389h-.389v.389c1.133.12 2.316.462 3.512.585.875.09 1.787.051 2.537.39l.782.389v.389h-1.56c-2.09.195-4.239-.317-5.659.97-.655.593-1.138 1.455-1.756 2.342-.489.703-.755 1.756-.587 2.927.134.928.804 1.807 1.172 2.731.543 1.368 1.103 2.732 1.952 3.902.756 1.043 1.466 2.243 2.732 2.927.57.307 1.61.376 2.342.585l.975.195c.607-.309 1.109-.925 1.561-1.366 1.082-1.054 2.148-2.428 2.927-3.709.487-.803.82-1.639 1.171-2.536.181-.462.158-.924.389-1.366.573-1.095 1.399-1.998 1.952-3.122.952-1.938 1.349-4.104 2.342-5.854.424-.748.978-1.5 1.367-2.147.412-.687.819-1.386.779-2.342-.261-.608-.425-1.472-.975-1.757z"/></svg>' :
                        s.type === 'mariadb' ? '<svg viewBox="0 0 128 128"><path fill="#003545" d="M4.5 108.1c.3.5.7 1 1.2 1.4 1.5 1.2 3.4 1.6 5.3 1.4 2.1-.2 4.1-.9 6-1.7 2.3-1 4.4-2.3 6.3-3.8 1.6-1.3 3.1-2.7 4.5-4.2.9-.9 1.7-1.9 2.4-2.9.6-.8 1.1-1.7 1.4-2.6.2-.7.3-1.4.2-2.1-.1-.8-.4-1.5-.9-2.1-.6-.8-1.4-1.3-2.3-1.7-1.1-.4-2.2-.6-3.4-.5-.9.1-1.8.3-2.6.6-.7.3-1.3.6-1.9 1-.5.3-.9.7-1.2 1.1-.3.4-.4.8-.4 1.2 0 .6.2 1.1.7 1.5.4.3.9.5 1.4.6.6.1 1.2 0 1.8-.3.5-.2.9-.6 1.1-1.1.2-.4.2-.9.1-1.3-.1-.4-.4-.8-.7-1-.5-.4-1.1-.6-1.7-.5-.6.1-1.2.4-1.6.9-.3.3-.5.8-.5 1.2 0 .5.2 1 .5 1.3.4.4.9.7 1.5.8.8.1 1.5-.1 2.2-.4.6-.3 1.1-.8 1.4-1.3.4-.6.5-1.4.4-2.1-.1-.6-.4-1.2-.9-1.6-.5-.4-1.1-.6-1.7-.6-.8 0-1.5.3-2.1.8-.5.5-.9 1.1-1 1.8-.2.8 0 1.7.4 2.4.5.8 1.2 1.4 2.1 1.7 1 .4 2.2.3 3.2-.2.9-.4 1.6-1.1 2-2 .5-1 .5-2.1.2-3.1-.4-1-.1-1.9-1.6-2.5-1.2-.5-2.6-.5-3.8-.1-1.3.5-2.4 1.3-3.3 2.3-1 1.1-1.8 2.4-2.4 3.8-.6 1.3-1 2.7-1.3 4.1-.3 1.3-.4 2.7-.4 4.1 0 .7 0 1.5.1 2.2.1.7.2 1.3.5 2 .2.6.5 1.2.9 1.7.4.5.9.9 1.4 1.2z"/><path fill="#C0765A" d="M125.5 19.9c-2.3-.3-4.6-.5-6.9-.5-3.8 0-7.7.4-11.4 1.3-4.7 1.1-9.2 2.9-13.3 5.2-4.5 2.6-8.5 5.8-12.1 9.5-3.6 3.8-6.6 8-9 12.6-2.2 4.3-3.8 8.8-4.9 13.5-.5 2.3-.9 4.6-1.1 7-.1.6-.1 1.2-.1 1.9 0 .3 0 .6.1.9 0 .2.1.4.2.6.1.1.2.2.4.2.2 0 .3-.1.5-.2.2-.2.4-.4.5-.6.2-.3.3-.6.4-.9.2-.5.3-1 .4-1.5.2-.8.4-1.7.6-2.5.7-2.3 1.4-4.5 2.3-6.7 1.8-4.3 4-8.4 6.7-12.2 2.5-3.6 5.4-6.9 8.7-9.8 3.1-2.8 6.5-5.2 10.2-7.2 3.4-1.9 7-3.4 10.8-4.5 3.3-1 6.7-1.6 10.2-1.8 1.6-.1 3.1-.1 4.6.1l2.5.3c.6.1 1.1.3 1.6.5.4.2.8.4 1.2.7.3.3.6.6.8 1 .2.4.3.8.3 1.2 0 .6-.2 1.1-.5 1.6-.4.6-.9 1-1.5 1.4-.8.4-1.6.7-2.5.8-1.1.2-2.2.2-3.3 0-.9-.1-1.8-.4-2.7-.8-.7-.3-1.3-.8-1.8-1.4-.4-.5-.6-1.1-.6-1.7 0-.7.3-1.3.8-1.8.5-.5 1.2-.8 1.9-1 .9-.2 1.9-.2 2.8 0 .8.2 1.5.6 2.1 1.1.5.5.8 1.1.9 1.8.1.6 0 1.2-.3 1.7-.4.5-.9.9-1.4 1.2-.7.3-1.4.5-2.2.4-.7 0-1.3-.2-1.9-.6-.5-.3-.8-.8-1-1.3-.1-.5-.1-1 .1-1.5.2-.4.5-.7.9-.9.5-.2 1-.2 1.5-.1s.9.4 1.2.8c.2.3.3.7.2 1.1-.1.4-.3.7-.6.9-.4.2-.8.3-1.2.2-.4-.1-.7-.3-.9-.6-.2-.3-.3-.7-.2-1.1.1-.3.3-.6.6-.8.2-.2.5-.3.8-.3.3 0 .7.1.9.3.3.3.5.6.5 1 0 .3-.1.5-.2.8-.2.4-.5.6-.9.8-.4.2-.8.2-1.2.1-.4-.1-.8-.3-1-.6-.2-.3-.3-.7-.2-1.1 0-.1.1-.3.2-.4z"/></svg>' :
                            s.type === 'nginx' ? '<svg viewBox="0 0 128 128"><path fill="#009639" d="M 28.998 110.667 L 44.271 118 L 44.271 10 L 28.998 17.333 Z"/><path fill="#009639" d="M 83.729 10 L 99.002 17.333 L 99.002 110.667 L 83.729 118 Z"/><path fill="#009639" d="M 44.271 10 L 44.271 35.333 L 83.729 92.667 L 83.729 118 L 44.271 60.667 L 44.271 35.333 Z"/></svg>' :
                                s.type === 'apache' ? '<svg viewBox="0 0 128 128"><path fill="#D22128" d="M64 0L4 117h20l8-15h64l8 15h20L64 0zm0 30l24 52H40l24-52z"/><path fill="#303284" d="M64 47l-12 26h24L64 47z"/></svg>' :
                                    s.type === 'redis' ? '<svg viewBox="0 0 128 128"><path fill="#A41E11" d="M121.8 93.1c-6.7 3.5-41.4 17.7-48.8 21.6-7.4 3.8-11.5 3.8-17.3.9C49.9 112.6 9 97.7 2.2 94.4c-3.4-1.7-5.2-3.1-5.2-4.4V75.4s48-10.5 55.9-13.4c7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 47.3 9.8 53.9 12.4v13.8c0 1.4-1.4 2.8-2.2 4.9z"/><path fill="#D82C20" d="M121.8 79.5c-6.7 3.5-41.4 17.7-48.8 21.6C65.6 105 61.5 105 55.7 102 49.9 99 9 84.1 2.2 80.8c-6.8-3.4-6.3-5.7-.2-8.1 6.1-2.4 40.9-16.3 48.8-19.3 7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 39.2 15.6 46 18.5s7.5 4.1.8 7.6z"/><path fill="#A41E11" d="M121.8 71.5c-6.7 3.5-41.4 17.7-48.8 21.6-7.4 3.8-11.5 3.8-17.3.9C49.9 91 9 76.1 2.2 72.8c-3.4-1.7-5.2-3.1-5.2-4.4V53.8s48-10.5 55.9-13.4c7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 47.3 9.8 53.9 12.4v13.8c0 1.3-1.4 2.8-2.2 4.9z"/><path fill="#D82C20" d="M121.8 57.9c-6.7 3.5-41.4 17.7-48.8 21.6-7.4 3.8-11.5 3.8-17.3.9C49.9 77.4 9 62.5 2.2 59.2c-6.8-3.4-6.3-5.7-.2-8.1 6.1-2.4 40.9-16.3 48.8-19.3 7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 39.2 15.6 46 18.5s7.5 4.1.8 7.6z"/><path fill="#A41E11" d="M121.8 50.1c-6.7 3.5-41.4 17.7-48.8 21.6-7.4 3.8-11.5 3.8-17.3.9C49.9 69.6 9 54.7 2.2 51.4c-3.4-1.7-5.2-3.1-5.2-4.4V32.4s48-10.5 55.9-13.4c7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 47.3 9.8 53.9 12.4V45c0 1.3-1.4 2.8-2.2 5.1z"/><path fill="#D82C20" d="M121.8 36.5c-6.7 3.5-41.4 17.7-48.8 21.6-7.4 3.8-11.5 3.8-17.3.9C49.9 56 9 41.1 2.2 37.8c-6.8-3.4-6.3-5.7-.2-8.1 6.1-2.4 40.9-16.3 48.8-19.3 7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 39.2 15.6 46 18.5s7.5 4.1.8 7.6z"/><path fill="#fff" d="M80.4 26.1L68 22.4l13.8-2.2-1.4 5.9zm-9.7 5.3l-5.8 11.5-8.3-17.2 14.1 5.7z"/><ellipse fill="#fff" cx="38.2" cy="35.5" rx="11.3" ry="4.4"/><path fill="#7A0C00" d="M93.3 27.7L77 34.8l-14.1-5.5 16-7.4z"/><path fill="#AD2115" d="M93.3 27.7L77 34.8V21.9z"/></svg>' :
                                        s.type === 'composer' ? '<svg viewBox="0 0 128 128"><path fill="#40454c" d="M16.403 17.856c7.49-8.506 19.003-13.163 28.028-14.502 10.139-1.505 18.637.23 22.48 1.327-7.705 5.64-13.9 12.57-18.31 19.49l2.122 1.41c4.2-6.587 10.053-13.157 17.388-18.493 14.464 4.693 27.522 14.973 35.122 27.582-6.058.926-11.21 3.96-14.696 7.987-4.618 5.332-6.707 12.53-5.726 19.748.962 7.076 4.636 13.57 10.37 18.36l-4.025 4.97c-1.018-1.22-2.056-2.475-3.108-3.763a104.408 104.408 0 01-8.403-12.07l-2.296 1.1c3.188 5.693 7.16 11.324 11.842 16.804 3.54 4.143 7.244 8.062 11.044 11.678l-7.148 6.36c-6.4-5.84-13.133-12.646-19.67-20.302-8.436-9.88-15.59-20.266-21.233-30.79l-2.1 1.48c5.825 10.867 13.24 21.632 22.066 31.933 6.794 7.93 13.816 15.002 20.495 21.087l-5.78 6.56c-14.698-11.92-31.352-28.632-45.52-49.368-12.03-17.608-20.63-35.41-25.596-51.64l2.562-1.038c4.722 15.417 12.9 32.336 24.38 49.134.28.412.556.823.84 1.232l2.076-1.52c-.403-.55-.8-1.104-1.19-1.66-11.87-16.963-20.31-34.198-25.317-50.023 3.59-6.47 8.393-12.293 14.104-17.162z"/><path fill="#885630" d="M116.776 110.2c-4.1 3.37-11.74 8.32-23.1 10-11.97 1.78-21.99-1.96-26.43-3.94h-.01c7.68-5.36 14.15-11.9 19.16-18.88l-2.1-1.42c-4.78 6.66-10.93 12.9-18.27 18.08-15.09-6.42-27.75-18.41-34.46-32.79 5.86-.9 10.89-3.6 14.44-7.42 5.11-5.48 7.62-13.18 6.88-21.13-.68-7.33-4-14.1-9.39-19.24l3.9-5.16c.97 1.28 1.97 2.59 2.99 3.94 2.68 3.56 5.52 7.53 8.51 11.92l2.25-1.21c-3.18-4.56-6.16-8.68-8.98-12.38-3.39-4.46-6.69-8.59-9.83-12.35l7.53-6.16c7.05 7.04 14.45 15.24 21.41 24.49 8.84 11.77 15.85 23.58 20.87 35.01l2.21-1.38c-5.17-11.77-12.34-24.01-21.53-36.23-7.24-9.64-15-18.22-22.38-25.61l6.4-6.46c15.45 14.05 33.08 33.3 46.39 56.51 11.63 20.28 18.35 40.15 20.06 57.97l-2.53.81c-1.4-16.83-7.6-35.78-18.51-55.01-.36-.64-.73-1.28-1.11-1.92l-2.19 1.32c.47.79.93 1.59 1.38 2.39 11.3 19.45 17.72 38.73 19.42 55.89-4.23 6.24-9.58 11.59-15.57 15.89z"/></svg>' :
                                            s.type === 'nodejs' ? '<svg viewBox="0 0 128 128"><path fill="#83CD29" d="M112.771 30.334L68.674 4.729c-2.781-1.584-6.402-1.584-9.205 0L14.901 30.334C12.031 31.985 10 35.088 10 38.407v51.142c0 3.319 2.084 6.423 4.954 8.083l11.775 6.688c5.628 2.772 7.617 2.772 10.178 2.772 8.333 0 13.093-5.039 13.093-13.828v-50.49c0-.713-.371-1.774-1.071-1.774h-5.623c-.712 0-2.306 1.061-2.306 1.773v50.49c0 3.896-3.524 7.773-10.11 4.48L18.723 90.73c-.424-.23-.723-.693-.723-1.181V38.407c0-.482.555-.966.982-1.213l44.424-25.561c.415-.235 1.025-.235 1.439 0l43.882 25.555c.42.253.272.722.272 1.219v51.142c0 .488.183.963-.232 1.198l-44.086 25.576c-.378.227-.847.227-1.261 0l-11.307-6.749c-.341-.198-.746-.269-1.073-.086-3.146 1.783-3.726 2.02-6.677 3.043-.726.253-1.797.692.41 1.929l14.798 8.754a9.294 9.294 0 004.647 1.246c1.642 0 3.25-.426 4.667-1.246l43.885-25.582c2.87-1.672 4.23-4.764 4.23-8.083V38.407c0-3.319-1.36-6.414-4.229-8.073zM77.91 81.445c-11.726 0-14.309-3.235-15.17-9.066-.1-.628-.633-1.379-1.272-1.379h-5.731c-.71 0-1.279.86-1.279 1.566 0 7.466 4.059 16.512 23.453 16.512 14.039 0 22.088-5.455 22.088-15.109 0-9.572-6.467-12.084-20.082-13.886-13.762-1.819-15.16-2.738-15.16-5.962 0-2.658 1.184-6.203 11.374-6.203 9.105 0 12.461 1.954 13.842 8.091.118.577.645 1.131 1.287 1.131h5.762c.36 0 .704-.224.953-.482.246-.271.321-.548.321-.869-.469-9.541-8.086-13.961-22.168-13.961-12.659 0-20.228 5.334-20.228 14.29 0 9.698 7.496 12.378 19.622 13.577 14.505 1.422 15.633 3.542 15.633 6.395 0 4.955-3.978 7.066-13.309 7.066z"/></svg>' :
                                                s.type === 'php' ? '<svg viewBox="0 0 128 128"><path fill="#6181B6" d="M64 33.039C30.26 33.039 2.906 46.901 2.906 64S30.26 94.961 64 94.961 125.094 81.099 125.094 64 97.74 33.039 64 33.039zM48.103 70.032c-1.458 1.364-3.077 1.927-4.86 2.507-1.783.581-4.052.461-6.811.461h-6.253l-1.733 10h-7.301l6.515-34H41.7c4.224 0 7.305 1.215 9.242 3.432 1.937 2.217 2.519 5.364 1.747 9.337-.319 1.637-.856 3.159-1.614 4.515a15.118 15.118 0 01-2.972 3.748zM69.414 73l2.881-14.42c.328-1.688.132-2.913-.586-3.676-.719-.764-1.94-1.15-3.659-1.15h-6.3L59.092 73h-7.32l6.199-32H65.14l-1.706 8.665h6.439c3.634 0 6.202.682 7.706 2.05 1.504 1.368 1.948 3.582 1.333 6.639L76.1 73h-6.686zm35.227-19.068c-.856 1.637-1.958 3.1-3.302 4.399-1.344 1.299-3.008 1.863-4.99 2.475-1.982.611-4.381.49-7.197.49h-6.19l-1.733 10H73.94l6.515-34h14.039c4.198 0 7.259 1.204 9.183 3.399 1.923 2.196 2.493 5.336 1.708 9.303-.319 1.637-.856 3.159-1.614 4.515-.374.687-.775 1.35-1.227 1.987a15.16 15.16 0 01-1.703 1.932z"/><path fill="#fff" d="M38.626 49.918h-5.052l-2.571 13.054h5.052c2.554 0 4.379-.405 5.469-1.217 1.088-.815 1.898-2.322 2.422-4.525.524-2.204.432-3.629-.276-4.28-.708-.648-2.213-.972-4.514-.972-.03 0-.061-.006-.092-.018-.031-.006-.061-.012-.092-.012h-.346zM78.07 53.748h-5.052l-2.571 13.054h5.052c2.554 0 4.378-.405 5.469-1.217 1.089-.815 1.898-2.322 2.422-4.525.524-2.204.432-3.629-.276-4.28-.708-.648-2.214-.972-4.514-.972-.03 0-.061-.006-.092-.018-.031-.006-.061-.012-.093-.012h-.345z"/><path fill="#fff" d="M38.626 46.147H24.587l-.346 1.78-.693 3.483-.693 3.483-.693 3.483-.346 1.78h5.052l2.571-13.054h5.052c2.301 0 3.806.324 4.514.972.708.651.8 2.076.276 4.28-.524 2.202-1.333 3.71-2.422 4.525-1.09.812-2.915 1.217-5.469 1.217h-5.052l-.693 3.483-.693 3.483-.693 3.483-.346 1.78h5.052l1.733-10h6.253c2.759 0 5.028.12 6.811-.461 1.783-.58 3.402-1.143 4.86-2.507a15.118 15.118 0 002.972-3.748c.758-1.356 1.295-2.878 1.614-4.515.772-3.973.19-7.12-1.747-9.337-1.937-2.217-5.018-3.432-9.242-3.432H38.626zM78.07 49.918h-5.052l-2.571 13.054h5.052c2.554 0 4.378-.405 5.469-1.217 1.089-.815 1.898-2.322 2.422-4.525.524-2.204.432-3.629-.276-4.28-.708-.648-2.214-.972-4.514-.972-.03 0-.061-.006-.092-.018-.031-.006-.061-.012-.093-.012h-.345z"/></svg>' :
                                                    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2" ry="2"/></svg>'
                    }
                                        </div>
                                        <div>
                                            <div class="service-name">${s.name} ${s.version}</div>
                                            <div class="service-port">Port: ${s.port || 'Default'}  Status: ${s.status}</div>
                                            ${s.port_in_use && s.status !== 'running' ? `<div style="color: var(--warning); font-size: 11px; margin-top: 4px;"> Port ${s.port} used by: ${s.port_conflict || 'another app'}</div>` : ''}
                                        </div>
                                    </div>
                                    <div class="service-actions">
                                        <span class="status-badge status-${s.status}"><span class="status-dot"></span>${s.status}${s.port_in_use && s.status !== 'running' ? ' (conflict)' : ''}</span>
                                        <button class="btn" onclick="${s.status === 'running' ? `stopService('${s.name}')` : `startService('${s.name}')`}" title="${s.status === 'running' ? 'Stop' : 'Start'}">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                ${s.status === 'running' ? '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>' : '<polygon points="5 3 19 12 5 21 5 3"/>'}
                                            </svg>
                                            ${s.status === 'running' ? 'Stop' : 'Start'}
                                        </button>
                                        ${s.status === 'running' ? `<button class="btn" onclick="restartService('${s.name}')" title="Restart">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M23 4v6h-6M1 20v-6h6"/>
                                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                            </svg>
                                        </button>` : ''}
                                        ${s.has_config ? `<button class="btn" onclick="editServiceConfig('${s.name}')" title="Config">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="3"/>
                                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                                            </svg>
                                        </button>` : ''}
                                        ${s.status !== 'running' ? `<button class="btn btn-icon-only btn-danger" onclick="uninstallService('${s.name}')" title="Uninstall">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="3 6 5 6 21 6"/>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                            </svg>
                                        </button>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div>
                            <h3 style="margin-bottom: 16px; font-size: 14px; text-transform: uppercase; color: var(--text-muted);">Available Services</h3>
                            <div class="card">
                                ${Object.keys(availableByType).filter(type => availableByType[type].some(v => !v.installed)).map(type => {
                        const availableVersions = availableByType[type].filter(v => !v.installed);
                        if (availableVersions.length === 0) return '';
                        return `
                                    <div class="list-item" style="padding: 16px 24px;">
                                        <div class="service-info">
                                            <div class="service-icon ${type}" style="width: 36px; height: 36px; font-size: 14px;">
                                                ${type === 'mysql' ? '<svg viewBox="0 0 128 128"><path fill="#00618A" d="M116.948 97.807c-6.863-.187-12.104.452-16.585 2.341-1.273.537-3.305.552-3.513 2.147.7.733.807 1.83 1.365 2.731 1.07 1.73 2.876 4.052 4.488 5.268 1.762 1.33 3.577 2.751 5.465 3.902 3.358 2.047 7.107 3.217 10.34 5.268 1.906 1.21 3.799 2.733 5.658 4.097.92.675 1.537 1.724 2.732 2.147v-.194c-.628-.79-.79-1.898-1.366-2.733l-2.537-2.537c-2.48-3.292-5.629-6.184-8.976-8.585-2.669-1.916-8.642-4.504-9.755-7.609l-.195-.195c1.892-.214 4.107-.898 5.854-1.367 2.934-.786 5.556-.583 8.585-1.365l4.097-1.171v-.78c-1.531-1.571-2.623-3.651-4.292-5.073-4.37-3.72-9.138-7.437-14.048-10.537-2.724-1.718-6.089-2.835-8.976-4.292-.971-.491-2.677-.746-3.318-1.562-1.517-1.932-2.342-4.382-3.511-6.633-2.449-4.717-4.854-9.868-7.024-14.831-1.48-3.384-2.447-6.72-4.292-9.756-8.86-14.567-18.396-23.358-33.169-32-3.144-1.838-6.929-2.563-10.929-3.513l-6.438-.389c-1.309-.547-2.676-2.149-3.902-2.927C11.931 4.319 5.3.625 1.907 4.411c-2.14 2.389.247 4.817 1.171 7.219.653 1.698 1.316 3.405 2.147 5.073.566 1.136 1.316 2.229 1.757 3.317 1.13 2.79 1.655 5.844 2.927 8.585 2.47 5.323 4.86 10.889 8.195 15.61 1.669 2.363 3.044 4.81 5.073 6.829 1.231 1.225 3.31 1.993 4.097 3.708-2.308 3.225-2.442 7.547-3.902 11.318-6.577 16.978-4.098 38.121 5.463 50.712 2.935 3.868 9.834 12.166 19.318 8.976 8.303-2.789 6.447-11.438 8.78-19.122z"/><path fill="#F29111" d="M52.767 43.76c-2.095.195-3.615.633-5.263 1.366v.389l2.342 2.342c1.414 1.464 2.971 3.53 4.293 4.682l.977.195c.934-.462 1.665-1.195 2.342-1.952 1.892-2.114 3.739-5.002 5.073-7.609l.39-.78h-.585c-.9.561-1.665.973-2.731 1.366-2.256.833-4.82.833-7.024.797z"/></svg>' :
                                type === 'mariadb' ? '<svg viewBox="0 0 128 128"><path fill="#003545" d="M4.5 108.1c.3.5.7 1 1.2 1.4 1.5 1.2 3.4 1.6 5.3 1.4 2.1-.2 4.1-.9 6-1.7 2.3-1 4.4-2.3 6.3-3.8 1.6-1.3 3.1-2.7 4.5-4.2.9-.9 1.7-1.9 2.4-2.9.6-.8 1.1-1.7 1.4-2.6.2-.7.3-1.4.2-2.1-.1-.8-.4-1.5-.9-2.1-.6-.8-1.4-1.3-2.3-1.7-1.1-.4-2.2-.6-3.4-.5z"/><path fill="#C0765A" d="M125.5 19.9c-2.3-.3-4.6-.5-6.9-.5-3.8 0-7.7.4-11.4 1.3-4.7 1.1-9.2 2.9-13.3 5.2-4.5 2.6-8.5 5.8-12.1 9.5-3.6 3.8-6.6 8-9 12.6-2.2 4.3-3.8 8.8-4.9 13.5-.5 2.3-.9 4.6-1.1 7-.1.6-.1 1.2-.1 1.9z"/></svg>' :
                                    type === 'nginx' ? '<svg viewBox="0 0 128 128"><path fill="#009639" d="M 28.998 110.667 L 44.271 118 L 44.271 10 L 28.998 17.333 Z"/><path fill="#009639" d="M 83.729 10 L 99.002 17.333 L 99.002 110.667 L 83.729 118 Z"/><path fill="#009639" d="M 44.271 10 L 44.271 35.333 L 83.729 92.667 L 83.729 118 L 44.271 60.667 L 44.271 35.333 Z"/></svg>' :
                                        type === 'apache' ? '<svg viewBox="0 0 128 128"><path fill="#D22128" d="M64 0L4 117h20l8-15h64l8 15h20L64 0zm0 30l24 52H40l24-52z"/><path fill="#303284" d="M64 47l-12 26h24L64 47z"/></svg>' :
                                            type === 'redis' ? '<svg viewBox="0 0 128 128"><path fill="#A41E11" d="M121.8 93.1c-6.7 3.5-41.4 17.7-48.8 21.6-7.4 3.8-11.5 3.8-17.3.9C49.9 112.6 9 97.7 2.2 94.4c-3.4-1.7-5.2-3.1-5.2-4.4V75.4s48-10.5 55.9-13.4c7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 47.3 9.8 53.9 12.4v13.8c0 1.4-1.4 2.8-2.2 4.9z"/><path fill="#D82C20" d="M121.8 79.5c-6.7 3.5-41.4 17.7-48.8 21.6C65.6 105 61.5 105 55.7 102 49.9 99 9 84.1 2.2 80.8c-6.8-3.4-6.3-5.7-.2-8.1 6.1-2.4 40.9-16.3 48.8-19.3 7.9-2.9 10.6-2.9 17.2 0 6.6 2.9 39.2 15.6 46 18.5s7.5 4.1.8 7.6z"/></svg>' :
                                                type === 'composer' ? '<svg viewBox="0 0 128 128"><path fill="#40454c" d="M16.403 17.856c7.49-8.506 19.003-13.163 28.028-14.502 10.139-1.505 18.637.23 22.48 1.327-7.705 5.64-13.9 12.57-18.31 19.49l2.122 1.41c4.2-6.587 10.053-13.157 17.388-18.493z"/><path fill="#885630" d="M116.776 110.2c-4.1 3.37-11.74 8.32-23.1 10-11.97 1.78-21.99-1.96-26.43-3.94h-.01c7.68-5.36 14.15-11.9 19.16-18.88l-2.1-1.42c-4.78 6.66-10.93 12.9-18.27 18.08z"/></svg>' :
                                                    type === 'nodejs' ? '<svg viewBox="0 0 128 128"><path fill="#83CD29" d="M112.771 30.334L68.674 4.729c-2.781-1.584-6.402-1.584-9.205 0L14.901 30.334C12.031 31.985 10 35.088 10 38.407v51.142c0 3.319 2.084 6.423 4.954 8.083l11.775 6.688c5.628 2.772 7.617 2.772 10.178 2.772 8.333 0 13.093-5.039 13.093-13.828v-50.49c0-.713-.371-1.774-1.071-1.774h-5.623c-.712 0-2.306 1.061-2.306 1.773v50.49c0 3.896-3.524 7.773-10.11 4.48z"/></svg>' :
                                                        type === 'php' ? '<svg viewBox="0 0 128 128"><path fill="#6181B6" d="M64 33.039C30.26 33.039 2.906 46.901 2.906 64S30.26 94.961 64 94.961 125.094 81.099 125.094 64 97.74 33.039 64 33.039z"/><path fill="#fff" d="M38.626 49.918h-5.052l-2.571 13.054h5.052c2.554 0 4.379-.405 5.469-1.217 1.088-.815 1.898-2.322 2.422-4.525.524-2.204.432-3.629-.276-4.28-.708-.648-2.213-.972-4.514-.972z"/></svg>' :
                                                            '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2" ry="2"/></svg>'}
                                            </div>
                                            <div>
                                                <div class="service-name" style="text-transform: capitalize;">${type} Server</div>
                                                <div class="service-port">Available versions: ${availableByType[type].length}</div>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 12px; align-items: center;">
                                            <select class="form-select" id="version-${type}" style="padding: 6px 12px; font-size: 13px; width: 140px;">
                                                ${availableVersions.map(v => `<option value="${v.version}">${v.version}</option>`).join('')}
                                            </select>
                                            <button class="btn btn-primary" onclick="installService('${type}')" style="padding: 8px 20px;">
                                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                                </svg>
                                                Install
                                            </button>
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                    </div>
                `;
                list.innerHTML = html;
            } catch (err) { }
        }

        async function installService(type) {
            const version = document.getElementById(`version-${type}`).value;
            try {
                await api('/services/install', 'POST', { type, version });
                showToast(`Starting installation of ${type} ${version}...`);

                // Show progress in a panel
                openDrawPanel(`Installing ${type}`, `
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Installing ${type} ${version}</span>
                            <span id="svc-install-percent">0%</span>
                        </div>
                        <div class="progress-bar-bg">
                            <div class="progress-bar-fill" id="svc-install-fill"></div>
                        </div>
                        <div class="install-log" id="svc-install-log">Starting installation...</div>
                    </div>
                `, null, 'Close');

                const interval = setInterval(async () => {
                    const status = await api(`/services/install-status?type=${type}&version=${version}`);
                    if (status && status.progress !== undefined) {
                        const progress = status.progress;
                        const fillEl = document.getElementById('svc-install-fill');
                        const percEl = document.getElementById('svc-install-percent');
                        const logEl = document.getElementById('svc-install-log');

                        if (progress === -1) {
                            clearInterval(interval);
                            const errorMsg = status.error || 'Unknown error';
                            if (logEl) logEl.innerHTML = `<span style="color: var(--danger);">Installation failed: ${errorMsg}</span>`;
                            return;
                        }
                        if (fillEl) fillEl.style.width = progress + '%';
                        if (percEl) percEl.textContent = progress + '%';
                        if (progress === 100) {
                            clearInterval(interval);
                            if (logEl) logEl.textContent = 'Installation complete!';
                            setTimeout(() => {
                                closeDrawPanel();
                                loadServices();
                            }, 1500);
                        }
                    }
                }, 1000);

            } catch (err) { showToast(err.message, 'error'); }
        }

        // ==========================================
        // Data Viewing
        // ==========================================

        async function loadDumps() {
            const list = document.getElementById('dumps-list');
            try {
                const data = await api('/dumps');
                if (!data || !data.dumps || !data.dumps.length) {
                    list.innerHTML = '<div class="empty-state"><p>No dumps recorded</p></div>';
                    return;
                }
                list.innerHTML = data.dumps.map(d => `
                    <div class="list-item" onclick="viewDump('${d.id}')" style="cursor: pointer;">
                        <div class="item-info">
                            <div class="item-primary">${d.file}:${d.line}</div>
                            <div class="item-secondary">${d.site || 'Unknown'}</div>
                        </div>
                        <span class="item-secondary">${new Date(d.timestamp).toLocaleString()}</span>
                    </div>
                `).join('');
            } catch (err) { }
        }

        async function viewDump(id) {
            try {
                const data = await api('/dumps');
                const dump = data.dumps.find(d => d.id === id);
                if (dump) {
                    openDrawPanel('Dump Details', `<pre style="padding:16px;background:#1e1e1e;color:#fff;overflow:auto;">${JSON.stringify(dump.data, null, 2)}</pre>`, null, 'Close');
                }
            } catch (err) { }
        }

        async function loadMail() {
            const list = document.getElementById('mail-list');
            try {
                const emails = await api('/mail');
                if (!emails || !emails.length) {
                    list.innerHTML = '<div class="empty-state"><p>No emails received</p></div>';
                    return;
                }
                list.innerHTML = emails.map(e => `
                    <div class="list-item" onclick="viewEmail('${e.id}')" style="cursor: pointer;">
                        <div class="item-info">
                            <div class="item-primary">${e.subject}</div>
                            <div class="item-secondary">From: ${e.from}</div>
                        </div>
                    </div>
                `).join('');
            } catch (err) { }
        }

        async function loadLogs() {
            const list = document.getElementById('logs-list');
            try {
                const logs = await api('/logs');
                if (!logs || !logs.length) {
                    list.innerHTML = '<div class="empty-state"><p>No log files found</p></div>';
                    return;
                }
                list.innerHTML = logs.map(l => `
                    <div class="list-item" onclick="viewLog('${l.path || l.name}')" style="cursor: pointer;">
                        <div class="item-info">
                            <div class="item-primary">${l.name}</div>
                        </div>
                    </div>
                `).join('');
            } catch (err) { }
        }

        async function viewEmail(id) {
            try {
                const emails = await api('/mail');
                const email = emails.find(e => e.id === id);
                if (email) {
                    openDrawPanel('Email: ' + email.subject, `<div style="padding:16px;">
                        <div style="margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--border);">
                            <div><strong>From:</strong> ${email.from}</div>
                            <div><strong>To:</strong> ${email.to}</div>
                            <div><strong>Date:</strong> ${new Date(email.timestamp).toLocaleString()}</div>
                        </div>
                        <div style="white-space:pre-wrap;">${email.body || email.html}</div>
                    </div>`, null, 'Close');
                }
            } catch (err) { showToast('Could not load email', 'error'); }
        }

        async function viewLog(path) {
            showOperationProgress('Loading log...');
            try {
                const logs = await api('/logs/view?path=' + encodeURIComponent(path) + '&lines=2000');
                hideOperationProgress();
                if (logs && logs.content) {
                    const lines = logs.content.split('\n');
                    const totalLines = lines.length;
                    let filteredLines = lines;
                    let searchTerm = '';

                    const renderLogContent = () => {
                        let html = filteredLines.map((line, i) => {
                            let displayLine = line.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                            // Highlight search term
                            if (searchTerm) {
                                const regex = new RegExp('(' + searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi');
                                displayLine = displayLine.replace(regex, '<mark style="background:#ffd54f;color:#000;padding:0 2px;border-radius:2px;">$1</mark>');
                            }
                            // Highlight error/warning keywords
                            if (/error|fatal|critical/i.test(line)) {
                                return `<div style="color:#ff6b6b;background:rgba(255,107,107,0.1);padding:2px 8px;margin:1px 0;border-left:3px solid #ff6b6b;">${displayLine}</div>`;
                            } else if (/warn/i.test(line)) {
                                return `<div style="color:#ffd93d;background:rgba(255,217,61,0.1);padding:2px 8px;margin:1px 0;border-left:3px solid #ffd93d;">${displayLine}</div>`;
                            } else if (/info|notice/i.test(line)) {
                                return `<div style="color:#4ecdc4;padding:2px 8px;">${displayLine}</div>`;
                            }
                            return `<div style="padding:2px 8px;">${displayLine}</div>`;
                        }).join('');
                        document.getElementById('log-content').innerHTML = html;
                    };

                    const panelContent = `
                        <div style="display:flex;flex-direction:column;height:100%;">
                            <div style="display:flex;gap:12px;margin-bottom:12px;align-items:center;">
                                <div style="position:relative;flex:1;">
                                    <input type="text" id="log-search" placeholder="Search logs..." style="width:100%;padding:8px 12px 8px 36px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;">
                                    <svg style="position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:0.5;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                                </div>
                                <span id="log-match-count" style="font-size:12px;color:var(--text-muted);min-width:80px;"></span>
                                <button class="btn" onclick="document.getElementById('log-content').scrollTop = document.getElementById('log-content').scrollHeight" title="Jump to end">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                                    Tail
                                </button>
                            </div>
                            <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px;">
                                 ${path}  ${totalLines.toLocaleString()} lines
                            </div>
                            <div id="log-content" style="flex:1;overflow:auto;background:#1e1e1e;border-radius:8px;font-family:'SF Mono',Monaco,monospace;font-size:12px;line-height:1.4;color:#d4d4d4;max-height:calc(100vh - 220px);"></div>
                        </div>
                    `;

                    openDrawPanel('Log: ' + path.split('/').pop(), panelContent, null, 'Close', true);
                    renderLogContent();

                    // Auto-scroll to end
                    setTimeout(() => {
                        const content = document.getElementById('log-content');
                        if (content) content.scrollTop = content.scrollHeight;
                    }, 100);

                    // Search functionality
                    document.getElementById('log-search').addEventListener('input', (e) => {
                        searchTerm = e.target.value;
                        if (searchTerm) {
                            filteredLines = lines.filter(line => line.toLowerCase().includes(searchTerm.toLowerCase()));
                            document.getElementById('log-match-count').textContent = filteredLines.length + ' matches';
                        } else {
                            filteredLines = lines;
                            document.getElementById('log-match-count').textContent = '';
                        }
                        renderLogContent();
                    });
                }
            } catch (err) {
                hideOperationProgress();
                showToast('Could not load log file', 'error');
            }
        }

        // ==========================================
        // Initialization
        // ==========================================

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('server-status-text').textContent = 'Server running on :' + window.location.port;
            const hash = window.location.hash.slice(1) || 'dashboard';
            showPage(hash);
            loadStatus();
            loadSettings();
            setInterval(loadStatus, 10000);
        });

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeDrawPanel();
        });
    </script>
</body>

</html>